<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Casino Roulette</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #ffd700;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(30, 30, 30, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            text-align: center;
        }
        h1 {
            text-align: center;
            text-shadow: 0 0 10px #ffd700;
        }
        h3 {
            margin: 10px 0;
        }
        .request {
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border: 1px solid #ffd700;
            border-radius: 5px;
            text-align: left;
        }
        button {
            padding: 5px 10px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ Admin Dashboard üé∞</h1>
        <div id="deposit-requests"><h3>Deposit Requests</h3></div>
        <div id="withdraw-requests"><h3>Withdraw Requests</h3></div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'admin123'; // Change in production
        const GITHUB_TOKEN = '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';
        const GITHUB_REPO = 'Opper125/casino-roulette';
        const GITHUB_API = `https://api.github.com/repos/${GITHUB_REPO}/contents`;

        const depositRequestsDiv = document.getElementById('deposit-requests');
        const withdrawRequestsDiv = document.getElementById('withdraw-requests');

        async function fetchGitHubData(file) {
            try {
                const response = await fetch(`${GITHUB_API}/${file}`, {
                    headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
                });
                if (response.ok) {
                    const data = await response.json();
                    return JSON.parse(atob(data.content));
                }
            } catch (e) {
                console.log('GitHub Fetch Error:', e);
            }
            return null;
        }

        async function updateGitHubData(file, data) {
            try {
                const existing = await fetchGitHubData(file);
                const content = btoa(JSON.stringify(data, null, 2));
                const response = await fetch(`${GITHUB_API}/${file}`, {
                    method: existing ? 'PUT' : 'POST',
                    headers: { 'Authorization': `token ${GITHUB_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Update ${file}`,
                        content,
                        sha: existing ? existing.sha : undefined
                    })
                });
                return response.ok;
            } catch (e) {
                console.log('GitHub Update Error:', e);
                return false;
            }
        }

        async function loadRequests() {
            const password = prompt('Admin Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´:');
            if (password !== ADMIN_PASSWORD) {
                alert('Password ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´!');
                return;
            }
            const requests = await fetchGitHubData('requests.json') || {};
            depositRequestsDiv.innerHTML = '<h3>Deposit Requests</h3>';
            withdrawRequestsDiv.innerHTML = '<h3>Withdraw Requests</h3>';
            Object.entries(requests).forEach(([id, req]) => {
                if (req.status === 'pending') {
                    if (req.type === 'deposit') {
                        const div = document.createElement('div');
                        div.className = 'request';
                        div.innerHTML = `
                            User: ${req.userId}<br>
                            Amount: ${req.amount} MMK<br>
                            Transaction ID: ${req.transactionId}<br>
                            <button onclick="approveRequest('${id}', 'deposit')">‚úÖ ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂</button>
                            <button onclick="rejectRequest('${id}', 'deposit')">‚ùå ·ÄÑ·Äº·ÄÑ·Ä∫·Ä∏·Äï·Äö·Ä∫</button>
                        `;
                        depositRequestsDiv.appendChild(div);
                    } else if (req.type === 'withdraw') {
                        const div = document.createElement('div');
                        div.className = 'request';
                        div.innerHTML = `
                            User: ${req.userId}<br>
                            Amount: ${req.amount} MMK<br>
                            Method: ${req.method}<br>
                            Phone: ${req.phone}<br>
                            <button onclick="approveRequest('${id}', 'withdraw')">‚úÖ ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂</button>
                            <button onclick="rejectRequest('${id}', 'withdraw')">‚ùå ·ÄÑ·Äº·ÄÑ·Ä∫·Ä∏·Äï·Äö·Ä∫</button>
                        `;
                        withdrawRequestsDiv.appendChild(div);
                    }
                }
            });
        }

        async function approveRequest(id, type) {
            const requests = await fetchGitHubData('requests.json') || {};
            if (requests[id]) {
                requests[id].status = 'approved';
                const userId = requests[id].userId;
                const amount = requests[id].amount;
                const userData = await fetchGitHubData('users.json') || {};
                if (type === 'deposit') {
                    userData[userId] = { balance: (userData[userId]?.balance || 0) + amount };
                }
                await updateGitHubData('users.json', userData);
                await updateGitHubData('requests.json', requests);
                loadRequests();
            }
        }

        async function rejectRequest(id, type) {
            const requests = await fetchGitHubData('requests.json') || {};
            if (requests[id]) {
                requests[id].status = 'rejected';
                const userId = requests[id].userId;
                const amount = requests[id].amount;
                const userData = await fetchGitHubData('users.json') || {};
                if (type === 'withdraw') {
                    userData[userId] = { balance: (userData[userId]?.balance || 0) + amount };
                }
                await updateGitHubData('users.json', userData);
                await updateGitHubData('requests.json', requests);
                loadRequests();
            }
        }

        // Initialize
        loadRequests();
    </script>
</body>
</html>
