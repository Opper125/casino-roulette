<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Casino Roulette</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #ffd700;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(30, 30, 30, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            text-align: center;
        }
        h1 {
            text-align: center;
            text-shadow: 0 0 10px #ffd700;
        }
        h3 {
            margin: 10px 0;
        }
        .request {
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border: 1px solid #ffd700;
            border-radius: 5px;
            text-align: left;
        }
        button {
            padding: 5px 10px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ Admin Dashboard üé∞</h1>
        <div id="game-status">Game Status: <span id="state">Betting</span> | Time Left: <span id="timeLeft">30s</span></div>
        <div id="online-players">Online Players: 0</div>
        <div id="deposit-requests"><h3>Deposit Requests</h3></div>
        <div id="withdraw-requests"><h3>Withdraw Requests</h3></div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'admin123'; // Change in production
        const GITHUB_TOKEN = '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';
        const GITHUB_REPO = 'Opper125/casino-roulette';
        const GITHUB_API = `https://api.github.com/repos/${GITHUB_REPO}/contents`;

        const depositRequestsDiv = document.getElementById('deposit-requests');
        const withdrawRequestsDiv = document.getElementById('withdraw-requests');
        const stateSpan = document.getElementById('state');
        const timeLeftSpan = document.getElementById('timeLeft');
        const onlinePlayersDiv = document.getElementById('online-players');

        async function fetchGitHubData(file) {
            try {
                const response = await fetch(`${GITHUB_API}/${file}`, {
                    headers: { 'Authorization': `token ${GITHUB_TOKEN}`, 'Accept': 'application/vnd.github.v3+json' }
                });
                if (response.ok) {
                    const data = await response.json();
                    return JSON.parse(atob(data.content));
                } else {
                    console.log(`Failed to fetch ${file}: ${response.status}`);
                }
            } catch (e) {
                console.log('GitHub Fetch Error:', e);
            }
            return null;
        }

        async function updateGitHubData(file, data) {
            try {
                const existing = await fetchGitHubData(file);
                const content = btoa(JSON.stringify(data, null, 2));
                const response = await fetch(`${GITHUB_API}/${file}`, {
                    method: existing ? 'PUT' : 'POST',
                    headers: { 
                        'Authorization': `token ${GITHUB_TOKEN}`, 
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: `Update ${file}`,
                        content,
                        sha: existing ? existing.sha : undefined
                    })
                });
                if (!response.ok) {
                    console.log(`Failed to update ${file}: ${response.status}`);
                }
                return response.ok;
            } catch (e) {
                console.log('GitHub Update Error:', e);
                return false;
            }
        }

        // Game Server Logic
        async function manageGameServer() {
            let gameData = await fetchGitHubData('game.json') || { state: 'betting', timeLeft: 30, bets: {}, onlinePlayers: {} };
            if (gameData.timeLeft > 0) {
                gameData.timeLeft--;
            } else {
                if (gameData.state === 'betting') {
                    gameData.state = 'spinning';
                    gameData.finalAngle = Math.floor(Math.random() * 360);
                    gameData.timeLeft = 8;
                    await updateGitHubData('game.json', gameData);
                    setTimeout(async () => {
                        gameData.result = checkBallPosition(gameData.finalAngle);
                        gameData.state = 'result';
                        gameData.timeLeft = 2;
                        await updateGitHubData('game.json', gameData);
                        setTimeout(async () => {
                            gameData.state = 'betting';
                            gameData.timeLeft = 30;
                            gameData.bets = {};
                            delete gameData.finalAngle;
                            delete gameData.result;
                            await updateGitHubData('game.json', gameData);
                        }, 2000);
                    }, 8000);
                }
            }
            await updateGitHubData('game.json', gameData);
            stateSpan.textContent = gameData.state;
            timeLeftSpan.textContent = `${gameData.timeLeft}s`;
            onlinePlayersDiv.textContent = `Online Players: ${Object.keys(gameData.onlinePlayers || {}).length}`;
        }

        function checkBallPosition(finalAngle) {
            const anglePerNumber = 360 / 36;
            const index = Math.floor(finalAngle / anglePerNumber);
            const number = (index % 36) + 1;
            const bonus = Math.floor(Math.random() * 451) + 50; // Bonus X (50-500)
            return {
                number,
                isRed: index % 2 === 1,
                isBlack: index % 2 === 0,
                isOdd: number % 2 === 1,
                isEven: number % 2 === 0,
                isLow: number <= 18,
                isHigh: number > 18,
                dozen: number <= 12 ? '1st12' : number <= 24 ? '2nd12' : '3rd12',
                column: index % 3 === 0 ? 'col1' : index % 3 === 1 ? 'col2' : 'col3',
                bonus
            };
        }

        async function loadRequests() {
            const password = prompt('Admin Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´:');
            if (password !== ADMIN_PASSWORD) {
                alert('Password ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´!');
                return;
            }
            setInterval(manageGameServer, 1000); // Start game server
            setInterval(async () => {
                const requests = await fetchGitHubData('requests.json') || {};
                depositRequestsDiv.innerHTML = '<h3>Deposit Requests</h3>';
                withdrawRequestsDiv.innerHTML = '<h3>Withdraw Requests</h3>';
                Object.entries(requests).forEach(([id, req]) => {
                    if (req.status === 'pending') {
                        if (req.type === 'deposit') {
                            const div = document.createElement('div');
                            div.className = 'request';
                            div.innerHTML = `
                                User: ${req.userId.substr(0, 8)}... (Phone: ${req.phone})<br>
                                Amount: ${req.amount} MMK<br>
                                Transaction ID: ${req.transactionId}<br>
                                <button onclick="approveRequest('${id}', 'deposit')">‚úÖ ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂</button>
                                <button onclick="rejectRequest('${id}', 'deposit')">‚ùå ·ÄÑ·Äº·ÄÑ·Ä∫·Ä∏·Äï·Äö·Ä∫</button>
                            `;
                            depositRequestsDiv.appendChild(div);
                        } else if (req.type === 'withdraw') {
                            const div = document.createElement('div');
                            div.className = 'request';
                            div.innerHTML = `
                                User: ${req.userId.substr(0, 8)}... (Phone: ${req.phone})<br>
                                Amount: ${req.amount} MMK<br>
                                Method: ${req.method}<br>
                                Phone: ${req.phone}<br>
                                <button onclick="approveRequest('${id}', 'withdraw')">‚úÖ ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂</button>
                                <button onclick="rejectRequest('${id}', 'withdraw')">‚ùå ·ÄÑ·Äº·ÄÑ·Ä∫·Ä∏·Äï·Äö·Ä∫</button>
                            `;
                            withdrawRequestsDiv.appendChild(div);
                        }
                    }
                });
            }, 1000);
        }

        async function approveRequest(id, type) {
            const requests = await fetchGitHubData('requests.json') || {};
            if (requests[id]) {
                requests[id].status = 'approved';
                const userId = requests[id].userId;
                const amount = requests[id].amount;
                const userData = await fetchGitHubData('users.json') || {};
                if (type === 'deposit') {
                    userData[userId].balance = (userData[userId]?.balance || 0) + amount;
                }
                const userSuccess = await updateGitHubData('users.json', userData);
                const requestSuccess = await updateGitHubData('requests.json', requests);
                if (!userSuccess || !requestSuccess) {
                    alert('Approval ·Äú·ÄØ·Äï·Ä∫·Äô·Äæ·ÄØ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã ·Äë·Äï·Ä∫·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·Äï·Ä´·Åã');
                }
            }
        }

        async function rejectRequest(id, type) {
            const requests = await fetchGitHubData('requests.json') || {};
            if (requests[id]) {
                requests[id].status = 'rejected';
                const userId = requests[id].userId;
                const amount = requests[id].amount;
                const userData = await fetchGitHubData('users.json') || {};
                if (type === 'withdraw') {
                    userData[userId].balance = (userData[userId]?.balance || 0) + amount;
                }
                const userSuccess = await updateGitHubData('users.json', userData);
                const requestSuccess = await updateGitHubData('requests.json', requests);
                if (!userSuccess || !requestSuccess) {
                    alert('Rejection ·Äú·ÄØ·Äï·Ä∫·Äô·Äæ·ÄØ ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Åã ·Äë·Äï·Ä∫·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·Äï·Ä´·Åã');
                }
            }
        }

        // Initialize
        loadRequests();
    </script>
</body>
</html>
