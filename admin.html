<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Casino Roulette</title>
    <style>
        /* ·Äô·Ä∞·Äõ·ÄÑ·Ä∫·Ä∏ CSS ·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äë·Ää·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã */
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #ffd700;
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(30, 30, 30, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            text-align: center;
        }
        h1 {
            text-align: center;
            text-shadow: 0 0 10px #ffd700;
        }
        h3 {
            margin: 10px 0;
        }
        .request {
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border: 1px solid #ffd700;
            border-radius: 5px;
            text-align: left;
        }
        button {
            padding: 5px 10px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ Admin Dashboard üé∞</h1>
        <div id="game-status">Game Status: <span id="state">Betting</span> | Time Left: <span id="timeLeft">30s</span></div>
        <div id="online-players">Online Players: 0</div>
        <div id="deposit-requests"><h3>Deposit Requests</h3></div>
        <div id="withdraw-requests"><h3>Withdraw Requests</h3></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAC0zvXE_Zv99c2RvMy3gpH5F4Is0Wm1oE",
            authDomain: "cacino-roulette.firebaseapp.com",
            databaseURL: "https://cacino-roulette-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "cacino-roulette",
            storageBucket: "cacino-roulette.firebasestorage.app",
            messagingSenderId: "794938085254",
            appId: "1:794938085254:web:cd9438d783dc1fad7ae607",
            measurementId: "G-WZWFMZD6N1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const ADMIN_PASSWORD = 'admin123'; // Production ·Äô·Äæ·Ä¨ ·Äï·Ä≠·ÄØ·Äú·ÄØ·Ä∂·ÄÅ·Äº·ÄØ·Ä∂·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Ä´
        const depositRequestsDiv = document.getElementById('deposit-requests');
        const withdrawRequestsDiv = document.getElementById('withdraw-requests');
        const stateSpan = document.getElementById('state');
        const timeLeftSpan = document.getElementById('timeLeft');
        const onlinePlayersDiv = document.getElementById('online-players');

        // Game Server Logic
        function manageGameServer() {
            db.ref('game').once('value', (snapshot) => {
                let gameData = snapshot.val() || {
                    state: 'betting',
                    timeLeft: 30,
                    bets: {},
                    onlinePlayers: 0,
                    bonusSlots: []
                };
                if (gameData.timeLeft > 0) {
                    gameData.timeLeft--;
                    if (gameData.state === 'betting' && gameData.timeLeft === 7) {
                        gameData.bonusSlots = generateBonusSlots();
                    }
                } else {
                    if (gameData.state === 'betting') {
                        gameData.state = 'spinning';
                        gameData.finalAngle = Math.floor(Math.random() * 360);
                        gameData.timeLeft = 8;
                    } else if (gameData.state === 'spinning') {
                        gameData.result = checkBallPosition(gameData.finalAngle);
                        gameData.state = 'result';
                        gameData.timeLeft = 2;
                        processWinnings(gameData.result);
                    } else if (gameData.state === 'result') {
                        gameData.state = 'betting';
                        gameData.timeLeft = 30;
                        gameData.bets = {};
                        gameData.bonusSlots = [];
                        delete gameData.finalAngle;
                        delete gameData.result;
                    }
                }
                gameData.onlinePlayers = Math.max(gameData.onlinePlayers, 1);
                db.ref('game').set(gameData);
                stateSpan.textContent = gameData.state;
                timeLeftSpan.textContent = `${gameData.timeLeft}s`;
                onlinePlayersDiv.textContent = `Online Players: ${gameData.onlinePlayers}`;
            });
        }

        function generateBonusSlots() {
            const bonusCount = Math.floor(Math.random() * 3) + 1; // 1-3 slots
            const bonusNumbers = new Set();
            while (bonusNumbers.size < bonusCount) {
                bonusNumbers.add(Math.floor(Math.random() * 36) + 1);
            }
            return Array.from(bonusNumbers).map(num => ({
                number: num,
                bonus: Math.floor(Math.random() * 451) + 50 // Bonus X (50-500)
            }));
        }

        function checkBallPosition(finalAngle) {
            const anglePerNumber = 360 / 36;
            const index = Math.floor(finalAngle / anglePerNumber);
            const number = (index % 36) + 1;
            const bonusData = bonusSlots.find(slot => slot.number === number);
            const bonus = bonusData ? bonusData.bonus : 0;
            return {
                number,
                isRed: index % 2 === 1,
                isBlack: index % 2 === 0,
                isOdd: number % 2 === 1,
                isEven: number % 2 === 0,
                isLow: number <= 18,
                isHigh: number > 18,
                dozen: number <= 12 ? '1st12' : number <= 24 ? '2nd12' : '3rd12',
                column: index % 3 === 0 ? 'col1' : index % 3 === 1 ? 'col2' : 'col3',
                bonus
            };
        }

        function processWinnings(result) {
            db.ref('game/bets').once('value', (snapshot) => {
                const bets = snapshot.val() || {};
                db.ref('users').once('value', (usersSnapshot) => {
                    const users = usersSnapshot.val();
                    Object.entries(bets).forEach(([area, amount]) => {
                        let multiplier = 0;
                        if (area === `${result.number}`) multiplier = 36 + (result.bonus || 0);
                        else if (area === 'red' && result.isRed) multiplier = 2;
                        else if (area === 'black' && result.isBlack) multiplier = 2;
                        else if (area === 'odd' && result.isOdd) multiplier = 2;
                        else if (area === 'even' && result.isEven) multiplier = 2;
                        else if (area === '1-18' && result.isLow) multiplier = 2;
                        else if (area === '19-36' && result.isHigh) multiplier = 2;
                        else if (area === result.dozen) multiplier = 3;
                        else if (area === result.column) multiplier = 3;
                        if (multiplier > 0) {
                            Object.keys(users).forEach(userId => {
                                const userBet = users[userId].bets?.[area] || 0;
                                if (userBet > 0) {
                                    const winnings = userBet * multiplier;
                                    db.ref(`users/${userId}`).update({
                                        balance: firebase.database.ServerValue.increment(winnings),
                                        bets: firebase.database.ServerValue.increment(-userBet)
                                    });
                                }
                            });
                        }
                    });
                });
            });
        }

        // Persistent Server Loop
        function startPersistentServer() {
            setInterval(manageGameServer, 1000); // Run server continuously
        }

        function loadRequests() {
            const password = prompt('Admin Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´:');
            if (password !== ADMIN_PASSWORD) {
                alert('Password ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´!');
                return;
            }
            firebase.auth().signInAnonymously().then(() => {
                startPersistentServer();
                syncRequests();
            });
        }

        function syncRequests() {
            db.ref('requests').on('value', (snapshot) => {
                const requests = snapshot.val() || {};
                depositRequestsDiv.innerHTML = '<h3>Deposit Requests</h3>';
                withdrawRequestsDiv.innerHTML = '<h3>Withdraw Requests</h3>';
                Object.entries(requests).forEach(([id, req]) => {
                    if (req.status === 'pending') {
                        const div = document.createElement('div');
                        div.className = 'request';
                        if (req.type === 'deposit') {
                            div.innerHTML = `
                                User: ${req.userId.substr(0, 8)}... (Phone: ${req.phone})<br>
                                Amount: ${req.amount} MMK<br>
                                Transaction ID: ${req.transactionId}<br>
                                <button onclick="approveRequest('${id}', 'deposit')">‚úÖ ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂</button>
                                <button onclick="rejectRequest('${id}', 'deposit')">‚ùå ·ÄÑ·Äº·ÄÑ·Ä∫·Ä∏·Äï·Äö·Ä∫</button>
                            `;
                            depositRequestsDiv.appendChild(div);
                        } else if (req.type === 'withdraw') {
                            div.innerHTML = `
                                User: ${req.userId.substr(0, 8)}... (Phone: ${req.phone})<br>
                                Amount: ${req.amount} MMK<br>
                                Method: ${req.method}<br>
                                Phone: ${req.phone}<br>
                                <button onclick="approveRequest('${id}', 'withdraw')">‚úÖ ·Äú·ÄÄ·Ä∫·ÄÅ·Ä∂</button>
                                <button onclick="rejectRequest('${id}', 'withdraw')">‚ùå ·ÄÑ·Äº·ÄÑ·Ä∫·Ä∏·Äï·Äö·Ä∫</button>
                            `;
                            withdrawRequestsDiv.appendChild(div);
                        }
                    }
                });
            });
        }

        function approveRequest(id, type) {
            db.ref('requests/' + id).once('value', (snapshot) => {
                const req = snapshot.val();
                if (req) {
                    if (type === 'deposit') {
                        db.ref('users/' + req.userId).update({
                            balance: firebase.database.ServerValue.increment(req.amount)
                        });
                    }
                    db.ref('requests/' + id).update({ status: 'approved' });
                }
            });
        }

        function rejectRequest(id, type) {
            db.ref('requests/' + id).once('value', (snapshot) => {
                const req = snapshot.val();
                if (req) {
                    if (type === 'withdraw') {
                        db.ref('users/' + req.userId).update({
                            balance: firebase.database.ServerValue.increment(req.amount)
                        });
                    }
                    db.ref('requests/' + id).update({ status: 'rejected' });
                }
            });
        }

        // Initialize
        loadRequests();
    </script>
</body>
</html>
