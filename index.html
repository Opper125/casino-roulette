<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·Ä°·ÄΩ·Äî·Ä∫·Äú·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏ ·ÄÄ·Ä¨·ÄÖ·ÄÆ·Äî·Ä≠·ÄØ ·Äõ·Ä≠·ÄØ·Ä∏·Äú·ÄÄ·Ä∫ ·ÄÇ·Ä≠·Äô·Ä∫·Ä∏</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2e0047, #1a1a1a);
            color: #fff;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            text-align: center;
        }
        h1 {
            color: #ffd700;
            text-shadow: 0 0 15px #ffd700;
            animation: glow 2s infinite;
            font-size: 2.5em;
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px #ffd700; }
            50% { text-shadow: 0 0 20px #ffd700; }
            100% { text-shadow: 0 0 5px #ffd700; }
        }
        #roulette-table {
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            gap: 2px;
            margin: 20px auto;
            width: 90%;
            background: #333;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #ffd700;
        }
        .slot {
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
            cursor: pointer;
            background: #444;
            border-radius: 5px;
            transition: background 0.3s;
            position: relative;
        }
        .slot:hover {
            background: #666;
        }
        .red { background: #ff4500; }
        .black { background: #1a1a1a; }
        .green { background: #00ff00; }
        #chit-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        .chit {
            padding: 10px 20px;
            background: #ffd700;
            color: #000;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            transition: transform 0.2s;
        }
        .chit:hover {
            transform: scale(1.1);
        }
        .selected { border: 3px solid #ff4500; }
        #timer {
            font-size: 2em;
            color: #00ff00;
            margin: 15px 0;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        #result {
            color: #ffd700;
            font-size: 1.5em;
            margin: 10px 0;
            position: relative;
        }
        #result span {
            display: inline-block;
            animation: spinResult 1s ease-out;
        }
        @keyframes spinResult {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        #history {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        .history-item {
            padding: 10px;
            background: #333;
            border-radius: 5px;
            font-size: 1.2em;
        }
        #total-bet, #user-bet {
            font-size: 1.2em;
            color: #00ffcc;
            margin: 10px 0;
        }
        #online-players {
            font-size: 1.2em;
            color: #ffd700;
            margin: 10px 0;
        }
        #login-container, #game-container {
            margin: 20px 0;
        }
        input, button {
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            margin: 10px;
            background: #333;
            color: #fff;
        }
        button {
            background: #ff4500;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.1);
        }
        .payout-animation {
            animation: payout 1s ease-out;
        }
        @keyframes payout {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        #support-menu {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>·Äõ·Ä≠·ÄØ·Ä∏·Äú·ÄÄ·Ä∫ ·ÄÄ·Ä¨·ÄÖ·ÄÆ·Äî·Ä≠·ÄØ ·ÄÇ·Ä≠·Äô·Ä∫·Ä∏</h1>
        <div id="login-container">
            <input type="text" id="phone" placeholder="·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Äê·Ä∫">
            <input type="password" id="pin" placeholder="6 ·Äú·ÄØ·Ä∂·Ä∏ PIN" maxlength="6">
            <button onclick="login()">·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äù·ÄÑ·Ä∫·Äô·Äö·Ä∫ / ·Äñ·ÄΩ·ÄÑ·Ä∑·Ä∫·Äô·Äö·Ä∫</button>
        </div>
        <div id="game-container" style="display: none;">
            <div id="timer">·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫: ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ää·Ä∫...</div>
            <div id="roulette-table"></div>
            <div id="chit-container"></div>
            <div id="result"></div>
            <div id="history"></div>
            <p id="total-bet">·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏ ·Äë·Ä≠·ÄØ·Ä∏·ÄÄ·Äº·Ä±·Ä∏: 0 ·ÄÄ·Äª·Äï·Ä∫</p>
            <p id="user-bet">·Äû·ÄÑ·Ä∑·Ä∫ ·Äë·Ä≠·ÄØ·Ä∏·ÄÄ·Äº·Ä±·Ä∏: 0 ·ÄÄ·Äª·Äï·Ä∫</p>
            <p id="online-players">Online ·ÄÄ·ÄÖ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏: 0 ·Ä¶·Ä∏</p>
            <p>·Äú·ÄÄ·Ä∫·ÄÄ·Äª·Äî·Ä∫·ÄÑ·ÄΩ·Ä±: <span id="balance">0</span> ·ÄÄ·Äª·Äï·Ä∫</p>
            <button onclick="logout()">·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·Äô·Äö·Ä∫</button>
            <div id="support-menu">
                <button onclick="window.location.href='https://casinoopper.netlify.app/customer-support.html'">·ÄÄ·ÄÖ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏ ·Ä°·ÄÄ·Ä∞·Ä°·Ää·ÄÆ</button>
            </div>
        </div>
    </div>

    <script>
        let balance = 0;
        let currentUser = null;
        let currentChit = null;
        let bets = {};
        let timeLeft = 0;
        let gameActive = false;
        let history = [];
        let onlinePlayers = new Set();

        const chits = [
            { value: 1000, label: "üí∞ 1k" },
            { value: 5000, label: "üí∞ 5k" },
            { value: 10000, label: "üí∞ 10k" },
            { value: 50000, label: "üí∞ 50k" },
            { value: 100000, label: "üí∞ 100k" },
            { value: 500000, label: "üí∞ 500k" },
            { value: 1000000, label: "üí∞ 1M" },
            { value: 5000000, label: "üí∞ 5M" },
            { value: 10000000, label: "üí∞ 10M" }
        ];

        function createRouletteTable() {
            const table = document.getElementById('roulette-table');
            table.innerHTML = '';
            const numbers = [
                "0", "3", "6", "9", "12", "15", "18", "21", "24", "27", "30", "33", "36",
                "2", "5", "8", "11", "14", "17", "20", "23", "26", "29", "32", "35", "1",
                "4", "7", "10", "13", "16", "19", "22", "25", "28", "31", "34"
            ];
            numbers.forEach((num, index) => {
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.innerText = num;
                if (num === "0") slot.classList.add('green');
                else if (["3", "9", "12", "18", "21", "27", "30", "36", "5", "14", "23", "32", "1", "7", "16", "19", "25", "34"].includes(num)) slot.classList.add('red');
                else slot.classList.add('black');
                slot.onclick = () => placeBet(num);
                table.appendChild(slot);
            });
        }

        function createChits() {
            const container = document.getElementById('chit-container');
            container.innerHTML = '';
            chits.forEach(chit => {
                const div = document.createElement('div');
                div.className = 'chit';
                div.innerText = chit.label;
                div.onclick = () => selectChit(chit.value);
                container.appendChild(div);
            });
        }

        function selectChit(value) {
            currentChit = value;
            document.querySelectorAll('.chit').forEach(chit => chit.classList.remove('selected'));
            const selectedChit = Array.from(document.querySelectorAll('.chit')).find(chit => chit.innerText === chits.find(c => c.value === value).label);
            selectedChit.classList.add('selected');
        }

        function placeBet(num) {
            if (!currentUser) return alert('·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äù·ÄÑ·Ä∫·Äï·Ä´·Åã');
            if (!currentChit) return alert('·Äú·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÄ·Äº·Ä±·Ä∏ ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´·Åã');
            if (!gameActive) return alert('·ÄÇ·Ä≠·Äô·Ä∫·Ä∏·Äï·Ä≠·Äê·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã');
            if (timeLeft <= 7) return alert('·Äú·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÄ·Äº·Ä±·Ä∏ ·Äï·Ä≠·Äê·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ·Åã');
            if (currentChit > balance) return alert('·Äú·ÄÄ·Ä∫·ÄÄ·Äª·Äî·Ä∫·ÄÑ·ÄΩ·Ä± ·Äô·Äú·ÄØ·Ä∂·Äú·Ä±·Ä¨·ÄÄ·Ä∫·Äï·Ä´·Åã');
            bets[num] = (bets[num] || 0) + currentChit;
            balance -= currentChit;
            updateBalance();
            updateTable();
            updateTotalBet();
        }

        function updateTable() {
            document.querySelectorAll('.slot').forEach(slot => {
                const num = slot.innerText.split('\n')[0];
                const allBets = JSON.parse(localStorage.getItem('allBets') || '{}');
                slot.innerHTML = `${num}<br>üí∞ ·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏: ${(allBets[num] || 0).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫<br>üí∞ ·Äû·ÄÑ·Ä∫: ${(bets[num] || 0).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫`;
            });
        }

        async function fetchGameState() {
            const response = await fetch('https://casinoopper.netlify.app/.netlify/functions/game');
            const data = await response.json();
            gameActive = data.active;
            timeLeft = data.timeLeft;
            document.getElementById('timer').innerText = gameActive ? `·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫: ${timeLeft} ·ÄÖ·ÄÄ·Äπ·ÄÄ·Äî·Ä∑·Ä∫` : '·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫: ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äû·Ää·Ä∫...';
            if (timeLeft <= 0 && gameActive) {
                const result = data.result || Math.floor(Math.random() * 37);
                document.getElementById('result').innerHTML = `·Äõ·Äú·Äí·Ä∫: <span>${result}</span>`;
                calculatePayout(result);
                addHistory(result);
                bets = {};
                updateTable();
                updateTotalBet();
            }
            updateOnlinePlayers();
        }

        function spinRoulette() {
            setInterval(async () => {
                await fetchGameState();
            }, 1000);
        }

        function calculatePayout(result) {
            if (bets[result]) {
                const payout = bets[result] * 35;
                balance += payout;
                document.getElementById('result').innerHTML += ` - ·Ä°·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äï·Ä´·Äï·Äº·ÄÆ! <span class="payout-animation">${payout.toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫</span>`;
                document.getElementById('balance').classList.add('payout-animation');
                setTimeout(() => document.getElementById('balance').classList.remove('payout-animation'), 1000);
            }
            updateBalance();
            saveGameResult(result);
        }

        function addHistory(result) {
            history.unshift(result);
            if (history.length > 7) history.pop();
            const historyDiv = document.getElementById('history');
            historyDiv.innerHTML = '';
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerText = item;
                historyDiv.appendChild(div);
            });
        }

        function updateTotalBet() {
            let allBets = JSON.parse(localStorage.getItem('allBets') || '{}');
            for (const [num, amount] of Object.entries(bets)) {
                allBets[num] = (allBets[num] || 0) + amount;
            }
            localStorage.setItem('allBets', JSON.stringify(allBets));
            const totalBet = Object.values(allBets).reduce((sum, val) => sum + val, 0);
            document.getElementById('total-bet').innerText = `·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏ ·Äë·Ä≠·ÄØ·Ä∏·ÄÄ·Äº·Ä±·Ä∏: ${totalBet.toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫`;
            const userBet = Object.values(bets).reduce((sum, val) => sum + val, 0);
            document.getElementById('user-bet').innerText = `·Äû·ÄÑ·Ä∑·Ä∫ ·Äë·Ä≠·ÄØ·Ä∏·ÄÄ·Äº·Ä±·Ä∏: ${userBet.toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫`;
        }

        function updateOnlinePlayers() {
            if (currentUser) onlinePlayers.add(currentUser.phone);
            localStorage.setItem('onlinePlayers', JSON.stringify([...onlinePlayers]));
            const players = JSON.parse(localStorage.getItem('onlinePlayers') || '[]');
            document.getElementById('online-players').innerText = `Online ·ÄÄ·ÄÖ·Ä¨·Ä∏·Äû·Äô·Ä¨·Ä∏: ${players.length} ·Ä¶·Ä∏`;
        }

        function updateBalance() {
            if (currentUser) {
                localStorage.setItem(`balance_${currentUser.phone}`, balance);
                document.getElementById('balance').innerText = balance.toLocaleString();
            }
        }

        function saveGameResult(result) {
            if (currentUser) {
                let history = JSON.parse(localStorage.getItem(`gameHistory_${currentUser.phone}`)) || [];
                history.push({ result, timestamp: new Date().toLocaleString() });
                localStorage.setItem(`gameHistory_${currentUser.phone}`, JSON.stringify(history));
            }
        }

        function login() {
            const phone = document.getElementById('phone').value;
            const pin = document.getElementById('pin').value;
            if (!phone || pin.length !== 6) return alert('·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Äê·Ä∫ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ PIN ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´·Åã');
            const userKey = `${phone}_${pin}`;
            const storedPin = localStorage.getItem(`pin_${phone}`);
            if (storedPin && storedPin !== pin) return alert('PIN ·Äô·Äô·Äæ·Äî·Ä∫·Äï·Ä´·Åã');
            if (!storedPin) localStorage.setItem(`pin_${phone}`, pin);
            currentUser = { phone, pin };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            balance = parseInt(localStorage.getItem(`balance_${phone}`)) || 0;
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            updateBalance();
            createRouletteTable();
            createChits();
            spinRoulette();
            updateOnlinePlayers();
        }

        function logout() {
            onlinePlayers.delete(currentUser.phone);
            localStorage.setItem('onlinePlayers', JSON.stringify([...onlinePlayers]));
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('game-container').style.display = 'none';
            updateOnlinePlayers();
        }

        window.onload = () => {
            const savedUser = JSON.parse(localStorage.getItem('currentUser'));
            if (savedUser) {
                currentUser = savedUser;
                balance = parseInt(localStorage.getItem(`balance_${currentUser.phone}`)) || 0;
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('game-container').style.display = 'block';
                updateBalance();
                createRouletteTable();
                createChits();
                spinRoulette();
                updateOnlinePlayers();
            }
        };
    </script>
</body>
</html>
