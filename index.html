<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Roulette - Game Zone Myanmar</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #ffd700;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .game-container {
            width: 100%;
            height: 100%;
            background: rgba(30, 30, 30, 0.95);
            padding: 5px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        h1 {
            font-size: 1.5em;
            margin: 5px 0;
            color: #8b4513;
            text-shadow: 0 0 10px #ffd700;
        }
        .roulette {
            width: 100%;
            max-width: 300px;
            height: 300px;
            background: #333;
            border-radius: 50%;
            margin: 5px auto;
            position: relative;
            border: 3px solid #ffd700;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: none;
        }
        .number-slot {
            position: absolute;
            width: 20px;
            height: 20px;
            text-align: center;
            font-size: 10px;
            color: #fff;
            transform-origin: 50% 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pointer {
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #fff, #ffd700);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid #000;
            z-index: 2;
        }
        .pointer.spinning {
            animation: spinBall 8s ease-out forwards;
        }
        @keyframes spinBall {
            0% { transform: translate(-50%, -50%) rotate(0deg) translateX(135px) rotate(0deg); }
            60% { transform: translate(-50%, -50%) rotate(1080deg) translateX(135px) rotate(-1080deg); }
            85% { transform: translate(-50%, -50%) rotate(var(--final-angle)) translateX(80px) rotate(-var(--final-angle)); }
            100% { transform: translate(-50%, -50%) rotate(var(--final-angle)) translateX(0) rotate(-var(--final-angle)); }
        }
        .bet-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 3px;
            width: 95%;
            margin: 5px auto;
            font-size: 0.8em;
        }
        .bet-area {
            padding: 5px;
            background: #333;
            border: 1px solid #ffd700;
            cursor: pointer;
            text-align: center;
            transition: background 0.2s;
            position: relative;
            min-height: 30px;
        }
        .bet-area:hover {
            background: #555;
        }
        .bet-area.red { background: #f44336; }
        .bet-area.black { background: #000; }
        .bet-area.green { background: #4caf50; }
        .bonus-x {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4500;
            color: #fff;
            padding: 3px;
            border-radius: 50%;
            font-size: 8px;
            animation: bonusPop 1s ease-in-out;
        }
        @keyframes bonusPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .bet-chip {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6px;
            color: #000;
        }
        .user-bet {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 6px;
            color: #00ff00;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px;
            border-radius: 3px;
        }
        .all-bet {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 6px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px;
            border-radius: 3px;
        }
        .bet-chips {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
            flex-wrap: wrap;
        }
        .chip {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
            font-size: 10px;
        }
        .chip:hover {
            transform: scale(1.1);
        }
        .chip.active {
            border: 2px solid #fff;
        }
        .chip-animation {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            animation: flyToBet 1s ease-out forwards;
        }
        @keyframes flyToBet {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(var(--target-x), var(--target-y)); opacity: 0; }
        }
        #result {
            font-size: 1em;
            margin: 5px 0 0 0;
            text-shadow: 0 0 5px #ffd700;
            flex-grow: 1;
        }
        #balance, #online-players {
            font-size: 1em;
            color: #ffd700;
            text-shadow: 0 0 5px #ffd700;
        }
        #balance {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        #online-players {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        .money-controls {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
        }
        input, select {
            padding: 5px;
            border: none;
            border-radius: 5px;
            background: #fff;
            color: #000;
            width: 80px;
            font-size: 10px;
        }
        button {
            padding: 5px 10px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
            font-size: 10px;
        }
        button:hover {
            transform: scale(1.1);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            box-shadow: none;
        }
        .menu-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            padding: 5px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            border: none;
            border-radius: 5px;
            color: #000;
            cursor: pointer;
            z-index: 2;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            font-size: 10px;
        }
        .guide {
            position: absolute;
            top: 40px;
            left: 5px;
            background: rgba(30, 30, 30, 0.95);
            padding: 10px;
            border-radius: 5px;
            color: #ffd700;
            font-size: 0.8em;
            z-index: 2;
            display: none;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            max-width: 200px;
        }
        .guide.active {
            display: block;
        }
        .timer {
            font-size: 1.2em;
            color: #ff4500;
            text-shadow: 0 0 5px #ff4500;
            margin: 5px 0;
        }
        .history {
            width: 95%;
            margin: 0 auto;
            padding: 5px 0;
            font-size: 0.8em;
            color: #ffd700;
            text-align: center;
            position: relative;
            top: -10px;
            z-index: 1;
        }
        .history-item {
            display: inline-block;
            margin: 0 5px;
            font-size: 12px;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .history-item.black {
            background: #000;
        }
        .history-item.red {
            background: #f44336;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .modal-content {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            color: #ffd700;
            text-align: center;
            width: 80%;
            max-width: 400px;
        }
        .modal input, .modal select {
            margin: 5px 0;
            width: 100%;
        }
        .modal button {
            margin: 5px;
        }
        #loginModal {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer" style="display: none;">
        <button class="menu-btn" onclick="toggleGuide()">ğŸ“œ Menu</button>
        <div class="guide" id="guide">
            ğŸ° <b>Casino Roulette á€€á€…á€¬á€¸á€”á€Šá€ºá€¸</b> ğŸ°<br>
            1. ğŸ’¸ á€„á€½á€±á€á€½á€„á€ºá€¸á€›á€”á€º "Deposit" á€”á€¾á€­á€•á€ºá€•á€¼á€®á€¸ Kpay/Wave á€–á€¯á€”á€ºá€¸ (09786284670 - DHMK) á€á€­á€¯á€· á€œá€½á€¾á€²á€•á€«á‹ á€„á€½á€±á€•á€™á€¬á€á€”á€¾á€„á€·á€º Transaction ID á€‘á€Šá€·á€ºá€•á€«á‹<br>
            2. ğŸ¦ á€„á€½á€±á€‘á€¯á€á€ºá€›á€”á€º "Withdraw" á€”á€¾á€­á€•á€ºá€•á€¼á€®á€¸ Kpay/Wave á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€ºá€”á€¾á€„á€·á€º á€•á€™á€¬á€á€‘á€Šá€·á€ºá€•á€«á‹<br>
            3. ğŸ² Chip (1K-1M) á€›á€½á€±á€¸á€•á€¼á€®á€¸ á€¡á€€á€½á€€á€ºá€•á€±á€«á€º á€”á€¾á€­á€•á€ºá€€á€¬ Bet á€á€„á€ºá€•á€«á‹<br>
            4. ğŸ”„ 30 á€…á€€á€¹á€€á€”á€·á€ºá€á€­á€¯á€„á€ºá€¸ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º Spin á€œá€¯á€•á€ºá€•á€¼á€®á€¸ Bonus X á€•á€¼á€•á€«á€á€šá€ºá‹<br>
            5. ğŸ¯ Bonus X (x50-x500) á€€á€­á€¯ á€€á€»á€•á€”á€ºá€¸á€¡á€€á€½á€€á€º 1-3 á€á€¯á€™á€¾á€¬ á€‘á€Šá€·á€ºá€•á€±á€¸á€•á€«á€á€šá€ºá‹<br>
            6. ğŸ† á€¡á€”á€­á€¯á€„á€ºá€›á€›á€„á€º 36x + Bonus X á€•á€±á€«á€„á€ºá€¸á€•á€¼á€®á€¸ Balance á€‘á€² á€‘á€Šá€·á€ºá€•á€±á€¸á€•á€«á€á€šá€ºá‹<br>
            ğŸ² <b>á€œá€±á€¬á€„á€ºá€¸á€€á€…á€¬á€¸ á€¡á€€á€½á€€á€ºá€™á€»á€¬á€¸ á€”á€²á€· á€¡á€œá€»á€±á€¬á€ºá€…á€¬á€¸:</b><br>
            - á€‚á€á€”á€ºá€¸ á á€œá€¯á€¶á€¸ (Straight): x36 (+ Bonus X)<br>
            - Black/Red: x2<br>
            - Odd/Even: x2<br>
            - 1-18/19-36: x2<br>
            - Dozens (1-12, 13-24, 25-36): x3<br>
            - Columns (1st, 2nd, 3rd): x3<br>
            ğŸ€ á€€á€¶á€€á€±á€¬á€„á€ºá€¸á€•á€«á€…á€±! ğŸ‰<br>
            <button onclick="toggleGuide()">âŒ á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
        <div id="online-players">Online Players: 0</div>
        <h1>ğŸ° Casino Roulette ğŸ°</h1>
        <div id="balance">Balance: <span id="balance-value">0</span> MMK</div>
        <div class="money-controls">
            <button onclick="showDepositModal()">ğŸ’¸ Deposit</button>
            <button onclick="showWithdrawModal()">ğŸ¦ Withdraw</button>
        </div>
        <div class="timer" id="timer">Time Left: 30s</div>
        <div class="roulette" id="roulette"></div>
        <div class="bet-table" id="betTable"></div>
        <div class="history" id="history"></div>
        <div class="bet-chips" id="betChips">
            <div class="chip" data-value="1000">1K</div>
            <div class="chip" data-value="5000">5K</div>
            <div class="chip" data-value="10000">10K</div>
            <div class="chip" data-value="20000">20K</div>
            <div class="chip" data-value="50000">50K</div>
            <div class="chip" data-value="100000">100K</div>
            <div class="chip" data-value="200000">200K</div>
            <div class="chip" data-value="500000">500K</div>
            <div class="chip" data-value="1000000">1M</div>
        </div>
        <button id="spinBtn" disabled>ğŸ² Spin á€œá€¯á€•á€ºá€•á€«</button>
        <div id="result">Admin á€–á€½á€„á€·á€ºá€™á€¾ Bet á€á€„á€ºá€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º! ğŸ°</div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>ğŸ® á€¡á€€á€±á€¬á€„á€·á€ºá€–á€½á€„á€·á€ºá€›á€”á€º</h2>
            <input type="text" id="phone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€º (09xxxxxxxxx)">
            <input type="password" id="pin" placeholder="PIN (6 á€œá€¯á€¶á€¸)">
            <button onclick="login()">á€á€„á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h2>ğŸ’¸ Deposit</h2>
            <p>Kpay/Wave á€–á€¯á€”á€ºá€¸: <b>09786284670</b> (DHMK)</p>
            <input type="number" id="deposit-amount" placeholder="á€„á€½á€±á€•á€™á€¬á€ (MMK)" min="100" step="100">
            <input type="text" id="transaction-id" placeholder="á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸ 6 á€œá€¯á€¶á€¸ (Transaction ID)">
            <button onclick="submitDeposit()">á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€™á€Šá€º</button>
            <button onclick="closeModal('depositModal')">âŒ á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h2>ğŸ¦ Withdraw</h2>
            <select id="withdraw-method">
                <option value="Kpay">Kpay</option>
                <option value="Wave">Wave</option>
            </select>
            <input type="text" id="withdraw-phone" placeholder="Kpay/Wave á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€º">
            <input type="number" id="withdraw-amount" placeholder="á€„á€½á€±á€•á€™á€¬á€ (MMK)" min="100" step="100">
            <button onclick="submitWithdraw()">á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€™á€Šá€º</button>
            <button onclick="closeModal('withdrawModal')">âŒ á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <script>
        let userId = localStorage.getItem('userId');
        let phone = localStorage.getItem('phone');
        let pin = localStorage.getItem('pin');
        let balance = parseInt(localStorage.getItem(`${userId}_balance`) || '0');
        let totalBet = 0;
        let currentChip = null;
        let bets = {};
        let allBets = {};
        let timeLeft = 30;
        let gameState = 'betting';
        let usedTransactionIds = [];
        let onlinePlayers = 0;
        let bonusSlots = [];
        let history = [];

        const spinBtn = document.getElementById('spinBtn');
        const balanceValue = document.getElementById('balance-value');
        const betTable = document.getElementById('betTable');
        const roulette = document.getElementById('roulette');
        const betChips = document.getElementById('betChips');
        const timer = document.getElementById('timer');
        const result = document.getElementById('result');
        const gameContainer = document.getElementById('gameContainer');
        const historyDiv = document.getElementById('history');

        // Load Data from Local Storage with Error Handling
        function loadData() {
            try {
                balance = parseInt(localStorage.getItem(`${userId}_balance`) || '0');
                usedTransactionIds = JSON.parse(localStorage.getItem(`${userId}_usedTransactionIds`) || '[]');
                bets = JSON.parse(localStorage.getItem(`bets_${userId}`) || '{}');
                allBets = JSON.parse(localStorage.getItem('allBets') || '{}');
                const gameData = JSON.parse(localStorage.getItem('gameData') || '{"state": "betting", "timeLeft": 30, "bets": {}, "onlinePlayers": 0, "bonusSlots": []}');
                gameState = gameData.state || 'betting';
                timeLeft = gameData.timeLeft || 30;
                onlinePlayers = gameData.onlinePlayers || 0;
                bonusSlots = gameData.bonusSlots || [];
                history = JSON.parse(localStorage.getItem('history') || '[]');
            } catch (e) {
                console.error('Error loading data from Local Storage:', e);
                resetData();
            }
        }

        // Reset Data to Default if Error Occurs
        function resetData() {
            balance = 0;
            usedTransactionIds = [];
            bets = {};
            allBets = {};
            gameState = 'betting';
            timeLeft = 30;
            onlinePlayers = 0;
            bonusSlots = [];
            history = [];
            saveData();
        }

        // Save Data to Local Storage with Error Handling
        function saveData() {
            try {
                localStorage.setItem(`${userId}_balance`, balance);
                localStorage.setItem(`${userId}_usedTransactionIds`, JSON.stringify(usedTransactionIds));
                localStorage.setItem(`bets_${userId}`, JSON.stringify(bets));
                localStorage.setItem('allBets', JSON.stringify(allBets));
                localStorage.setItem('history', JSON.stringify(history));
                const gameData = { state: gameState, timeLeft, bets: allBets, onlinePlayers, bonusSlots };
                localStorage.setItem('gameData', JSON.stringify(gameData));
            } catch (e) {
                console.error('Error saving data to Local Storage:', e);
            }
        }

        // Login Function
        function login() {
            const inputPhone = document.getElementById('phone').value;
            const inputPin = document.getElementById('pin').value;
            if (!inputPhone || !inputPin || inputPin.length !== 6 || !inputPhone.match(/^09\d{8,9}$/)) {
                result.innerHTML = "âŒ á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€º á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º PIN á€™á€™á€¾á€”á€ºá€•á€«!";
                return;
            }
            phone = inputPhone;
            pin = inputPin;
            userId = btoa(phone + pin); // Anonymous ID
            localStorage.setItem('userId', userId);
            localStorage.setItem('phone', phone);
            localStorage.setItem('pin', pin);
            loadData();
            onlinePlayers++;
            saveData();
            document.getElementById('loginModal').style.display = 'none';
            gameContainer.style.display = 'flex';
            updateUI();
            syncGameState();
        }

        // Update UI
        function updateUI() {
            updateBalance();
            document.getElementById('online-players').innerHTML = `Online Players: ${onlinePlayers}`;
            updateBetCounts(allBets);
            updateHistory();
            timer.innerHTML = `Time Left: ${timeLeft}s`;
        }

        // Sync Game State
        function syncGameState() {
            setInterval(() => {
                try {
                    const gameData = JSON.parse(localStorage.getItem('gameData') || '{}');
                    if (!gameData.state) {
                        result.innerHTML = "â³ Admin á€–á€½á€„á€·á€ºá€›á€”á€º á€…á€±á€¬á€„á€·á€ºá€•á€«...";
                        betTable.style.display = 'none';
                        betChips.style.display = 'none';
                        roulette.style.display = 'none';
                        return;
                    }
                    gameState = gameData.state;
                    timeLeft = gameData.timeLeft;
                    allBets = gameData.bets || {};
                    onlinePlayers = gameData.onlinePlayers || 0;
                    bonusSlots = gameData.bonusSlots || [];
                    timer.innerHTML = `Time Left: ${timeLeft}s`;
                    document.getElementById('online-players').innerHTML = `Online Players: ${onlinePlayers}`;
                    updateBetCounts(allBets);
                    if (gameState === 'betting' && timeLeft > 7) {
                        betTable.style.display = 'grid';
                        betChips.style.display = 'flex';
                        roulette.style.display = 'none';
                        result.innerHTML = "ğŸ² Chip á€›á€½á€±á€¸á€•á€¼á€®á€¸ Bet á€á€„á€ºá€•á€«!";
                    } else if (gameState === 'betting' && timeLeft <= 7) {
                        betTable.style.display = 'none';
                        betChips.style.display = 'none';
                        result.innerHTML = "â³ Betting á€•á€­á€á€ºá€á€±á€¬á€·á€™á€Šá€º!";
                    } else if (gameState === 'spinning') {
                        spinWheel(gameData.finalAngle);
                    } else if (gameState === 'result') {
                        showResult(gameData.result);
                    }
                } catch (e) {
                    console.error('Error syncing game state:', e);
                    result.innerHTML = "âŒ á€‚á€­á€™á€ºá€¸á€¡á€œá€¯á€•á€ºá€™á€œá€¯á€•á€ºá€•á€«á‹ Admin á€–á€½á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€•á€«á‹";
                }
            }, 1000);
        }

        function setupRoulette() {
            const numbers = Array.from({ length: 36 }, (_, i) => i + 1);
            numbers.forEach((num, i) => {
                const slot = document.createElement('div');
                slot.className = 'number-slot';
                slot.textContent = num;
                slot.style.transform = `rotate(${i * 10}deg) translateY(-135px)`;
                slot.style.background = i % 2 === 0 ? '#000' : '#f44336';
                roulette.appendChild(slot);
            });
            const pointer = document.createElement('div');
            pointer.id = 'pointer';
            pointer.className = 'pointer';
            roulette.appendChild(pointer);
        }

        function updateBalance(amount = 0) {
            if (amount !== 0) {
                balance += amount;
                saveData();
            }
            balanceValue.innerHTML = balance;
            document.getElementById('balance').innerHTML = `Balance: <span id="balance-value">${balance}</span> MMK`;
        }

        function updateTotalBet() {
            totalBet = Object.values(bets).reduce((sum, value) => sum + value, 0);
        }

        function showDepositModal() { document.getElementById('depositModal').style.display = 'flex'; }
        function showWithdrawModal() { document.getElementById('withdrawModal').style.display = 'flex'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }

        function submitDeposit() {
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const transactionId = document.getElementById('transaction-id').value;
            if (!amount || amount < 100 || !transactionId || transactionId.length !== 6 || usedTransactionIds.includes(transactionId)) {
                result.innerHTML = "âŒ á€„á€½á€±á€•á€™á€¬á€ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º Transaction ID á€™á€™á€¾á€”á€ºá€€á€”á€ºá€•á€«!";
                return;
            }
            usedTransactionIds.push(transactionId);
            saveData();
            const requestId = `${userId}_${Date.now()}`;
            let requests = JSON.parse(localStorage.getItem('requests') || '{}');
            requests[requestId] = { 
                userId, 
                amount, 
                transactionId, 
                phone, 
                type: 'deposit', 
                status: 'pending', 
                timestamp: Date.now() 
            };
            localStorage.setItem('requests', JSON.stringify(requests));
            result.innerHTML = "â³ Deposit á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€™á€¾á€¯ á€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!";
            closeModal('depositModal');
            checkRequestStatus(requestId, 'deposit');
        }

        function submitWithdraw() {
            const method = document.getElementById('withdraw-method').value;
            const phoneWithdraw = document.getElementById('withdraw-phone').value;
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            if (!amount || amount < 100 || amount > balance || !phoneWithdraw) {
                result.innerHTML = "âŒ á€„á€½á€±á€•á€™á€¬á€ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€º á€™á€™á€¾á€”á€ºá€€á€”á€ºá€•á€«!";
                return;
            }
            updateBalance(-amount);
            const requestId = `${userId}_${Date.now()}`;
            let requests = JSON.parse(localStorage.getItem('requests') || '{}');
            requests[requestId] = { 
                userId, 
                amount, 
                method, 
                phone: phoneWithdraw, 
                type: 'withdraw', 
                status: 'pending', 
                timestamp: Date.now() 
            };
            localStorage.setItem('requests', JSON.stringify(requests));
            result.innerHTML = "â³ Withdraw á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€™á€¾á€¯ á€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!";
            closeModal('withdrawModal');
            checkRequestStatus(requestId, 'withdraw');
        }

        function checkRequestStatus(requestId, type) {
            const interval = setInterval(() => {
                try {
                    const requests = JSON.parse(localStorage.getItem('requests') || '{}');
                    if (requests[requestId] && requests[requestId].status !== 'pending') {
                        clearInterval(interval);
                        if (requests[requestId].status === 'approved') {
                            if (type === 'deposit') {
                                updateBalance(requests[requestId].amount);
                            }
                            result.innerHTML = `âœ… ${type === 'deposit' ? 'Deposit' : 'Withdraw'} á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€•á€¼á€®!`;
                        } else {
                            if (type === 'withdraw') updateBalance(requests[requestId].amount);
                            result.innerHTML = `âŒ ${type === 'deposit' ? 'Deposit' : 'Withdraw'} á€•á€šá€ºá€á€»á€á€¶á€›á€•á€«á€á€šá€º!`;
                        }
                    }
                } catch (e) {
                    console.error('Error checking request status:', e);
                    clearInterval(interval);
                }
            }, 1000);
        }

        function setupBetTable() {
            const table = [
                ...Array.from({ length: 36 }, (_, i) => ({
                    id: `${i + 1}`,
                    text: `${i + 1}`,
                    class: i % 2 === 0 ? 'black' : 'red',
                    colSpan: 1
                })),
                { id: '1-18', text: '1-18', class: '', colSpan: 2 },
                { id: '19-36', text: '19-36', class: '', colSpan: 2 },
                { id: 'odd', text: 'Odd', class: '', colSpan: 2 },
                { id: 'even', text: 'Even', class: '', colSpan: 2 },
                { id: 'black', text: 'Black', class: 'black', colSpan: 2 },
                { id: 'red', text: 'Red', class: 'red', colSpan: 2 },
                { id: '1st12', text: '1-12', class: '', colSpan: 2 },
                { id: '2nd12', text: '13-24', class: '', colSpan: 2 },
                { id: '3rd12', text: '25-36', class: '', colSpan: 2 },
                { id: 'col1', text: '1st', class: '', colSpan: 2 },
                { id: 'col2', text: '2nd', class: '', colSpan: 2 },
                { id: 'col3', text: '3rd', class: '', colSpan: 2 }
            ];
            table.forEach(area => {
                const div = document.createElement('div');
                div.className = `bet-area ${area.class}`;
                div.id = `bet-${area.id}`;
                div.innerHTML = `
                    ${area.text}
                    <span class="user-bet" id="user-bet-${area.id}">0</span>
                    <span class="all-bet" id="all-bet-${area.id}">0</span>
                `;
                div.style.gridColumn = area.colSpan > 1 ? `span ${area.colSpan}` : 'auto';
                div.onclick = () => placeBet(area.id);
                betTable.appendChild(div);
            });
        }

        function placeBet(areaId) {
            if (gameState !== 'betting' || timeLeft <= 7 || !currentChip || balance < currentChip) return;
            balance -= currentChip;
            updateBalance();
            bets[areaId] = (bets[areaId] || 0) + currentChip;
            allBets[areaId] = (allBets[areaId] || 0) + currentChip;
            saveData();
            try {
                const gameData = JSON.parse(localStorage.getItem('gameData') || '{}');
                gameData.bets = allBets;
                localStorage.setItem('gameData', JSON.stringify(gameData));
            } catch (e) {
                console.error('Error updating game data in placeBet:', e);
            }
            updateBetCounts(allBets);
            const chipElement = document.createElement('div');
            chipElement.className = 'chip-animation';
            chipElement.textContent = currentChip >= 1000 ? `${currentChip/1000}K` : currentChip;
            const balancePos = balanceValue.getBoundingClientRect();
            const targetPos = document.getElementById(`bet-${areaId}`).getBoundingClientRect();
            chipElement.style.left = `${balancePos.left + balancePos.width / 2 - 15}px`;
            chipElement.style.top = `${balancePos.top + balancePos.height / 2 - 15}px`;
            chipElement.style.setProperty('--target-x', `${targetPos.left - balancePos.left}px`);
            chipElement.style.setProperty('--target-y', `${targetPos.top - balancePos.top}px`);
            document.body.appendChild(chipElement);
            setTimeout(() => {
                chipElement.remove();
            }, 1000);
        }

        function updateBetCounts(allBets) {
            for (let i = 1; i <= 36; i++) {
                const userBetEl = document.getElementById(`user-bet-${i}`);
                const allBetEl = document.getElementById(`all-bet-${i}`);
                if (userBetEl) userBetEl.innerHTML = bets[i] ? (bets[i] >= 1000 ? `${bets[i]/1000}K` : bets[i]) : '0';
                if (allBetEl) allBetEl.innerHTML = allBets[i] ? (allBets[i] >= 1000 ? `${allBets[i]/1000}K` : allBets[i]) : '0';
                const bonusEl = document.getElementById(`bet-${i}`).querySelector('.bonus-x');
                if (bonusSlots.some(slot => slot.number === i)) {
                    if (!bonusEl) {
                        const bonusX = document.createElement('span');
                        bonusX.className = 'bonus-x';
                        bonusX.innerHTML = `x${bonusSlots.find(slot => slot.number === i).bonus}`;
                        document.getElementById(`bet-${i}`).appendChild(bonusX);
                    }
                } else if (bonusEl) {
                    bonusEl.remove();
                }
            }
            ['1-18', '19-36', 'odd', 'even', 'black', 'red', '1st12', '2nd12', '3rd12', 'col1', 'col2', 'col3'].forEach(area => {
                const userBetEl = document.getElementById(`user-bet-${area}`);
                const allBetEl = document.getElementById(`all-bet-${area}`);
                if (userBetEl) userBetEl.innerHTML = bets[area] ? (bets[area] >= 1000 ? `${bets[area]/1000}K` : bets[area]) : '0';
                if (allBetEl) allBetEl.innerHTML = allBets[area] ? (allBets[area] >= 1000 ? `${allBets[area]/1000}K` : allBets[area]) : '0';
            });
        }

        function spinWheel(finalAngle) {
            const pointer = document.getElementById('pointer');
            roulette.style.display = 'block';
            betTable.style.display = 'none';
            betChips.style.display = 'none';
            result.innerHTML = "á€˜á€±á€¬á€œá€¯á€¶á€¸á€œá€¾á€Šá€·á€ºá€”á€±á€•á€«á€á€šá€º... â³";
            pointer.style.setProperty('--final-angle', `${finalAngle}deg`);
            pointer.classList.add('spinning');
            setTimeout(() => pointer.classList.remove('spinning'), 8000);
        }

        function showResult(resultData) {
            try {
                const number = resultData.number;
                let winnings = 0;
                let message = `ğŸ² á€˜á€±á€¬á€œá€¯á€¶á€¸á€›á€•á€ºá€á€½á€¬á€¸á€á€²á€· á€‚á€á€”á€ºá€¸: ${number}<br>`;
                const bonusMultiplier = bonusSlots.find(slot => slot.number === parseInt(number))?.bonus || 0;
                for (let area in bets) {
                    let multiplier = 0;
                    if (area === `${number}`) multiplier = 36 + bonusMultiplier;
                    else if (area === 'red' && resultData.isRed) multiplier = 2;
                    else if (area === 'black' && resultData.isBlack) multiplier = 2;
                    else if (area === 'odd' && resultData.isOdd) multiplier = 2;
                    else if (area === 'even' && resultData.isEven) multiplier = 2;
                    else if (area === '1-18' && resultData.isLow) multiplier = 2;
                    else if (area === '19-36' && resultData.isHigh) multiplier = 2;
                    else if (area === resultData.dozen) multiplier = 3;
                    else if (area === resultData.column) multiplier = 3;
                    if (multiplier > 0) winnings += bets[area] * multiplier;
                }
                if (winnings > 0) {
                    message += `ğŸ‰ á€¡á€”á€­á€¯á€„á€ºá€›á€›á€¾á€­á€•á€«á€á€šá€º! ${winnings} MMK`;
                    updateBalance(winnings);
                } else {
                    message += "ğŸ˜¢ á€¡á€›á€¾á€¯á€¶á€¸á€•á€«á‹ á€‘á€•á€ºá€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€•á€«!";
                }
                result.innerHTML = message;
                bets = {};
                allBets = {};
                totalBet = 0;
                saveData();
                const gameData = JSON.parse(localStorage.getItem('gameData') || '{}');
                gameData.bets = allBets;
                localStorage.setItem('gameData', JSON.stringify(gameData));
                updateBetCounts(allBets);
                updateTotalBet();
                clearBetTable();
                updateHistory(resultData);
            } catch (e) {
                console.error('Error in showResult:', e);
                result.innerHTML = "âŒ á€›á€œá€’á€ºá€•á€¼á€á€™á€¾á€¯ á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á‹";
            }
        }

        function clearBetTable() {
            for (let i = 1; i <= 36; i++) {
                const betArea = document.getElementById(`bet-${i}`);
                const chip = betArea && betArea.querySelector('.bet-chip');
                if (chip) chip.remove();
            }
            ['1-18', '19-36', 'odd', 'even', 'black', 'red', '1st12', '2nd12', '3rd12', 'col1', 'col2', 'col3'].forEach(area => {
                const betArea = document.getElementById(`bet-${area}`);
                const chip = betArea && betArea.querySelector('.bet-chip');
                if (chip) chip.remove();
            });
        }

        function updateHistory(resultData) {
            try {
                history.push({ number: resultData.number, isBlack: resultData.isBlack });
                if (history.length > 10) {
                    history.shift();
                }
                localStorage.setItem('history', JSON.stringify(history));
                let historyHTML = '';
                history.forEach(item => {
                    const className = item.isBlack ? 'black' : 'red';
                    historyHTML += `<span class="history-item ${className}">${item.number}</span> `;
                });
                historyDiv.innerHTML = historyHTML || 'No history yet';
            } catch (e) {
                console.error('Error updating history:', e);
                historyDiv.innerHTML = 'Error loading history';
            }
        }

        document.querySelectorAll('.chip').forEach(chip => {
            chip.onclick = () => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                currentChip = parseInt(chip.dataset.value);
            };
        });

        function toggleGuide() {
            document.getElementById('guide').classList.toggle('active');
        }

        // Initialize
        if (userId && phone && pin) {
            document.getElementById('loginModal').style.display = 'none';
            gameContainer.style.display = 'flex';
            loadData();
            updateUI();
            syncGameState();
        } else {
            result.innerHTML = "ğŸ® á€¡á€€á€±á€¬á€„á€·á€ºá€–á€½á€„á€·á€ºá€›á€”á€º á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€ºá€”á€¾á€„á€·á€º PIN á€‘á€Šá€·á€ºá€•á€«!";
        }
        setupBetTable();
        setupRoulette();
    </script>
</body>
</html>
