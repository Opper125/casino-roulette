<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Roulette - Game Zone Myanmar</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #ffd700; margin: 0; padding: 10px; }
        .game-container { max-width: 400px; margin: auto; background: rgba(30, 30, 30, 0.9); padding: 15px; border-radius: 10px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); text-align: center; }
        h1 { font-size: 1.5em; text-shadow: 0 0 10px #ffd700; }
        .bet-table { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin: 10px 0; }
        .bet-area { padding: 8px; background: #333; border: 2px solid #ffd700; cursor: pointer; border-radius: 5px; }
        .bet-area:hover { background: #555; }
        .chip { width: 40px; height: 40px; border-radius: 50%; background: #ffd700; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; margin: 5px; }
        .chip.active { border: 3px solid #fff; }
        button { padding: 8px 15px; background: #ffd700; color: #000; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; justify-content: center; align-items: center; }
        .modal-content { background: #1e1e1e; padding: 20px; border-radius: 10px; color: #ffd700; width: 90%; max-width: 400px; }
        .support-section { margin-top: 20px; background: #333; padding: 10px; border-radius: 5px; }
        textarea { width: 100%; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>🎰 Casino Roulette 🎰</h1>
        <div id="online-players">Online Players: 0</div>
        <div id="balance">Balance: <span id="balance-value">0</span> MMK</div>
        <div class="money-controls">
            <button onclick="showDepositModal()">💸 Deposit</button>
            <button onclick="showWithdrawModal()">🏦 Withdraw</button>
        </div>
        <div class="timer" id="timer">Time Left: 30s</div>
        <div class="bet-table" id="betTable"></div>
        <div class="bet-chips">
            <div class="chip" data-value="1000">1K</div>
            <div class="chip" data-value="10000">10K</div>
            <div class="chip" data-value="100000">100K</div>
        </div>
        <div id="result">ကစားရန် အကောင့်ဝင်ပါ!</div>
        <div class="support-section">
            <h3>📞 Customer Support</h3>
            <textarea id="support-message" placeholder="သင့်မေးခွန်းကို ရေးပါ..."></textarea>
            <button onclick="sendSupportMessage()">📩 ပို့မည်</button>
        </div>
    </div>

    <div class="modal" id="loginModal" style="display: flex;">
        <div class="modal-content">
            <h2>🎮 အကောင့်ဝင်ရန်</h2>
            <input type="text" id="phone" placeholder="ဖုန်းနံပတ် (09xxxxxxxxx)">
            <input type="password" id="pin" placeholder="PIN (6 လုံး)">
            <button onclick="login()">ဝင်မည်</button>
        </div>
    </div>

    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h2>💸 Deposit</h2>
            <p>Kpay/Wave: <b>09786284670</b> (DHMK)</p>
            <input type="number" id="deposit-amount" placeholder="ငွေပမာဏ (MMK)">
            <input type="text" id="transaction-id" placeholder="Transaction ID (6 လုံး)">
            <button onclick="submitDeposit()">တောင်းဆိုမည်</button>
            <button onclick="closeModal('depositModal')">❌ ပိတ်မည်</button>
        </div>
    </div>

    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h2>🏦 Withdraw</h2>
            <input type="text" id="withdraw-phone" placeholder="Kpay/Wave ဖုန်းနံပတ်">
            <input type="number" id="withdraw-amount" placeholder="ငွေပမာဏ (MMK)">
            <button onclick="submitWithdraw()">တောင်းဆိုမည်</button>
            <button onclick="closeModal('withdrawModal')">❌ ပိတ်မည်</button>
        </div>
    </div>

    <script>
        const GITHUB_TOKEN = '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';
        const REPO = 'casino-roulette';
        const OWNER = 'Opper125';
        const FILE_PATH = 'data.json';

        let userId, phone, balance = 0, bets = {}, timeLeft = 30, gameState = 'betting';

        async function syncData(action, updates = {}) {
            const response = await fetch('/.netlify/functions/sync', {
                method: 'POST',
                body: JSON.stringify({ action, updates, token: GITHUB_TOKEN, repo: REPO, owner: OWNER, path: FILE_PATH })
            });
            return await response.json();
        }

        async function login() {
            phone = document.getElementById('phone').value;
            const pin = document.getElementById('pin').value;
            if (!phone.match(/^09\d{8,9}$/) || pin.length !== 6) {
                document.getElementById('result').innerHTML = "❌ ဖုန်း သို့မဟုတ် PIN မမှန်ပါ!";
                return;
            }
            userId = btoa(phone + pin);
            const data = await syncData('get');
            const users = data.users || {};
            let userData = users[userId] || { balance: 10000, bets: {}, phone };
            balance = userData.balance;
            bets = userData.bets;
            users[userId] = userData;
            data.game.onlinePlayers = (data.game.onlinePlayers || 0) + 1;
            await syncData('set', { users, game: data.game });
            updateUI();
            document.getElementById('loginModal').style.display = 'none';
            syncGameState();
        }

        function updateUI() {
            document.getElementById('balance-value').innerHTML = balance;
            document.getElementById('timer').innerHTML = `Time Left: ${timeLeft}s`;
            syncData('get').then(data => {
                document.getElementById('online-players').innerHTML = `Online Players: ${data.game.onlinePlayers || 0}`;
                if (gameState === 'betting') document.getElementById('result').innerHTML = "🎲 Bet တင်ပါ!";
                else if (gameState === 'spinning') document.getElementById('result').innerHTML = "⏳ လှည့်နေပါတယ်...";
                else if (gameState === 'result') showResult(data);
            });
        }

        function syncGameState() {
            setInterval(async () => {
                const data = await syncData('get');
                let game = data.game || { state: 'betting', timeLeft: 30, onlinePlayers: 0 };
                gameState = game.state;
                timeLeft = game.timeLeft > 0 ? game.timeLeft - 1 : 0;
                if (timeLeft === 0) {
                    if (gameState === 'betting') {
                        gameState = 'spinning';
                        timeLeft = 8;
                    } else if (gameState === 'spinning') {
                        gameState = 'result';
                        timeLeft = 2;
                    } else {
                        gameState = 'betting';
                        timeLeft = 30;
                    }
                }
                game = { state: gameState, timeLeft, onlinePlayers: game.onlinePlayers };
                await syncData('set', { game });
                updateUI();
            }, 1000);
        }

        function setupBetTable() {
            const table = ['1', '2', '3', '4', '5', '6', 'red', 'black', 'odd', 'even', '1-18', '19-36'];
            table.forEach(id => {
                const div = document.createElement('div');
                div.className = 'bet-area';
                div.id = `bet-${id}`;
                div.innerHTML = id;
                div.onclick = () => placeBet(id);
                document.getElementById('betTable').appendChild(div);
            });
        }

        async function placeBet(areaId) {
            const chip = parseInt(document.querySelector('.chip.active')?.dataset.value);
            if (gameState !== 'betting' || !chip || balance < chip) return;
            balance -= chip;
            bets[areaId] = (bets[areaId] || 0) + chip;
            const data = await syncData('get');
            data.users[userId] = { balance, bets, phone };
            await syncData('set', data);
            updateUI();
        }

        document.querySelectorAll('.chip').forEach(chip => {
            chip.onclick = () => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
            };
        });

        async function showResult(data) {
            const result = { number: Math.floor(Math.random() * 36) + 1 };
            let winnings = bets[result.number] ? bets[result.number] * 36 : 0;
            balance += winnings;
            bets = {};
            data.users[userId] = { balance, bets, phone };
            await syncData('set', data);
            document.getElementById('result').innerHTML = winnings ? `🎉 အနိုင်ရ: ${winnings} MMK` : "😢 အရှုံးပါ";
        }

        function showDepositModal() { document.getElementById('depositModal').style.display = 'flex'; }
        function showWithdrawModal() { document.getElementById('withdrawModal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        async function submitDeposit() {
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const transactionId = document.getElementById('transaction-id').value;
            if (amount < 100 || transactionId.length !== 6) return;
            const data = await syncData('get');
            const requestId = `${userId}_${Date.now()}`;
            data.requests[requestId] = { userId, phone, amount, transactionId, type: 'deposit', status: 'pending' };
            await syncData('set', data);
            closeModal('depositModal');
        }

        async function submitWithdraw() {
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            const withdrawPhone = document.getElementById('withdraw-phone').value;
            if (amount < 100 || amount > balance || !withdrawPhone) return;
            balance -= amount;
            const data = await syncData('get');
            data.users[userId].balance = balance;
            const requestId = `${userId}_${Date.now()}`;
            data.requests[requestId] = { userId, phone, amount, withdrawPhone, type: 'withdraw', status: 'pending' };
            await syncData('set', data);
            closeModal('withdrawModal');
            updateUI();
        }

        async function sendSupportMessage() {
            const message = document.getElementById('support-message').value;
            if (!message || !userId) return;
            const data = await syncData('get');
            data.messages.push({ userId, phone, message, timestamp: Date.now() });
            await syncData('set', data);
            document.getElementById('support-message').value = '';
            alert('မက်ဆေ့ချ် ပို့ပြီးပါပြီ!');
        }

        setupBetTable();
    </script>
</body>
</html>
