<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Roulette - ·Ä°·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Ä°·Äõ·Äæ·ÄØ·Ä∂·Ä∏ Game</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a1a;
            color: #ffd700;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .game-container {
            width: 100%;
            height: 100%;
            background: rgba(30, 30, 30, 0.95);
            padding: 5px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        h1 {
            font-size: 1.5em;
            margin: 5px 0;
            text-shadow: 0 0 10px #ffd700;
        }
        .roulette {
            width: 100%;
            max-width: 300px;
            height: 300px;
            background: #333;
            border-radius: 50%;
            margin: 5px auto;
            position: relative;
            border: 3px solid #ffd700;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: none;
        }
        .number-slot {
            position: absolute;
            width: 20px;
            height: 20px;
            text-align: center;
            font-size: 10px;
            color: #fff;
            transform-origin: 50% 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .pointer {
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #fff, #ffd700);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid #000;
            z-index: 2;
        }
        .pointer.spinning {
            animation: spinBall 8s ease-out forwards;
        }
        @keyframes spinBall {
            0% { transform: translate(-50%, -50%) rotate(0deg) translateX(135px) rotate(0deg); }
            60% { transform: translate(-50%, -50%) rotate(1080deg) translateX(135px) rotate(-1080deg); }
            85% { transform: translate(-50%, -50%) rotate(var(--final-angle)) translateX(80px) rotate(-var(--final-angle)); }
            100% { transform: translate(-50%, -50%) rotate(var(--final-angle)) translateX(0) rotate(-var(--final-angle)); }
        }
        .bet-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 3px;
            width: 95%;
            margin: 5px auto;
            font-size: 0.8em;
        }
        .bet-area {
            padding: 5px;
            background: #333;
            border: 1px solid #ffd700;
            cursor: pointer;
            text-align: center;
            transition: background 0.2s;
            position: relative;
            min-height: 30px;
        }
        .bet-area:hover {
            background: #555;
        }
        .bet-area.red { background: #f44336; }
        .bet-area.black { background: #000; }
        .bet-area.green { background: #4caf50; }
        .bonus-x {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4500;
            color: #fff;
            padding: 3px;
            border-radius: 50%;
            font-size: 8px;
            animation: bonusPop 1s ease-in-out;
        }
        @keyframes bonusPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .bet-chip {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6px;
            color: #000;
        }
        .bet-chips {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
            flex-wrap: wrap;
        }
        .chip {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
            font-size: 10px;
        }
        .chip:hover {
            transform: scale(1.1);
        }
        .chip.active {
            border: 2px solid #fff;
        }
        .chip-animation {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            animation: flyToBet 1s ease-out forwards;
        }
        @keyframes flyToBet {
            0% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(var(--target-x), var(--target-y)); opacity: 0; }
        }
        #result {
            font-size: 1em;
            margin: 5px 0;
            text-shadow: 0 0 5px #ffd700;
        }
        #total-bet {
            font-size: 1em;
            margin: 5px 0;
            text-shadow: 0 0 5px #ffd700;
        }
        #balance {
            font-size: 1em;
            margin: 5px 0;
            text-shadow: 0 0 5px #ffd700;
            position: absolute;
            top: 5px;
            right: 5px;
        }
        .money-controls {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
        }
        input, select {
            padding: 5px;
            border: none;
            border-radius: 5px;
            background: #fff;
            color: #000;
            width: 80px;
            font-size: 10px;
        }
        button {
            padding: 5px 10px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            transition: transform 0.2s;
            font-size: 10px;
        }
        button:hover {
            transform: scale(1.1);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            box-shadow: none;
        }
        .menu-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            padding: 5px;
            background: linear-gradient(45deg, #ffd700, #b8860b);
            border: none;
            border-radius: 5px;
            color: #000;
            cursor: pointer;
            z-index: 2;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            font-size: 10px;
        }
        .guide {
            position: absolute;
            top: 40px;
            left: 5px;
            background: rgba(30, 30, 30, 0.95);
            padding: 10px;
            border-radius: 5px;
            color: #ffd700;
            font-size: 0.8em;
            z-index: 2;
            display: none;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            max-width: 200px;
        }
        .guide.active {
            display: block;
        }
        .timer {
            font-size: 1.2em;
            color: #ff4500;
            text-shadow: 0 0 5px #ff4500;
            margin: 5px 0;
        }
        .online-players {
            font-size: 1em;
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            text-shadow: 0 0 5px #ffd700;
        }
        .bet-area .player-count {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 6px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px;
            border-radius: 3px;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .modal-content {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            color: #ffd700;
            text-align: center;
            width: 80%;
            max-width: 400px;
        }
        .modal input, .modal select {
            margin: 5px 0;
            width: 100%;
        }
        .modal button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="menu-btn" onclick="toggleGuide()">üìú Menu</button>
        <div class="guide" id="guide">
            üé∞ <b>Casino Roulette ·ÄÄ·ÄÖ·Ä¨·Ä∏·Äî·Ää·Ä∫·Ä∏</b> üé∞<br>
            1. üí∏ ·ÄÑ·ÄΩ·Ä±·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫ "Deposit" ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Äº·ÄÆ·Ä∏ Kpay/Wave ·Äñ·ÄØ·Äî·Ä∫·Ä∏ (09786284670 - DHMK) ·Äû·Ä≠·ÄØ·Ä∑ ·Äú·ÄΩ·Äæ·Ä≤·Äï·Ä´·Åã ·ÄÑ·ÄΩ·Ä±·Äï·Äô·Ä¨·Äè·Äî·Äæ·ÄÑ·Ä∑·Ä∫ Transaction ID ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã<br>
            2. üè¶ ·ÄÑ·ÄΩ·Ä±·Äë·ÄØ·Äê·Ä∫·Äõ·Äî·Ä∫ "Withdraw" ·Äî·Äæ·Ä≠·Äï·Ä∫·Äï·Äº·ÄÆ·Ä∏ Kpay/Wave ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Äê·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äï·Äô·Ä¨·Äè·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã<br>
            3. üé≤ Chip (1K-1M) ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏ ·Ä°·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äï·Ä±·Ä´·Ä∫ ·Äî·Äæ·Ä≠·Äï·Ä∫·ÄÄ·Ä¨ Bet ·Äê·ÄÑ·Ä∫·Äï·Ä´ (Total Bet ·Äë·Ä≤ ·Äï·Äº·Äï·Ä´·Äê·Äö·Ä∫)·Åã<br>
            4. üîÑ 30 ·ÄÖ·ÄÄ·Äπ·ÄÄ·Äî·Ä∑·Ä∫·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏ ·Ä°·Äú·Ä≠·ÄØ·Ä°·Äú·Äª·Ä±·Ä¨·ÄÄ·Ä∫ Spin ·Äú·ÄØ·Äï·Ä∫·Äï·Äº·ÄÆ·Ä∏ Bonus X ·Äï·Äº·Äï·Ä´·Äê·Äö·Ä∫·Åã<br>
            5. üéØ Bonus X (x50-x500) ·ÄÄ·Ä≠·ÄØ ·ÄÄ·Äª·Äï·Äî·Ä∫·Ä∏·Ä°·ÄÄ·ÄΩ·ÄÄ·Ä∫ 1-3 ·ÄÅ·ÄØ·Äô·Äæ·Ä¨ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã<br>
            6. üèÜ ·Ä°·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äõ·ÄÑ·Ä∫ 36x + Bonus X ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏ Balance ·Äë·Ä≤ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã<br>
            üé≤ <b>·Äú·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÄ·ÄÖ·Ä¨·Ä∏ ·Ä°·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äî·Ä≤·Ä∑ ·Ä°·Äú·Äª·Ä±·Ä¨·Ä∫·ÄÖ·Ä¨·Ä∏:</b><br>
            - ·ÄÇ·Äè·Äî·Ä∫·Ä∏ ·ÅÅ ·Äú·ÄØ·Ä∂·Ä∏ (Straight): x36 (+ Bonus X)<br>
            - Black/Red: x2<br>
            - Odd/Even: x2<br>
            - 1-18/19-36: x2<br>
            - Dozens (1-12, 13-24, 25-36): x3<br>
            - Columns (1st, 2nd, 3rd): x3<br>
            üçÄ ·ÄÄ·Ä∂·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Ä´·ÄÖ·Ä±! üéâ<br>
            <button onclick="toggleGuide()">‚ùå ·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫</button>
        </div>
        <div class="online-players" id="online-players">Online Players: 0</div>
        <h1>üé∞ Casino Roulette üé∞</h1>
        <div id="balance">Balance: <span id="balance-value">0</span> MMK</div>
        <div class="money-controls">
            <button onclick="showDepositModal()">üí∏ Deposit</button>
            <button onclick="showWithdrawModal()">üè¶ Withdraw</button>
        </div>
        <div id="total-bet">Total Bet: <span id="total-bet-value">0</span> MMK</div>
        <div class="timer" id="timer">Time Left: 30s</div>
        <div class="roulette" id="roulette"></div>
        <div class="bet-table" id="betTable"></div>
        <div class="bet-chips" id="betChips">
            <div class="chip" data-value="1000">1K</div>
            <div class="chip" data-value="5000">5K</div>
            <div class="chip" data-value="10000">10K</div>
            <div class="chip" data-value="20000">20K</div>
            <div class="chip" data-value="50000">50K</div>
            <div class="chip" data-value="100000">100K</div>
            <div class="chip" data-value="200000">200K</div>
            <div class="chip" data-value="500000">500K</div>
            <div class="chip" data-value="1000000">1M</div>
        </div>
        <button id="spinBtn" onclick="spinWheel()" disabled>üé≤ Spin ·Äú·ÄØ·Äï·Ä∫·Äï·Ä´</button>
        <div id="result">Chip ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏ Bet ·Äê·ÄÑ·Ä∫·Äï·Ä´! üé∞</div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h2>üí∏ Deposit</h2>
            <p>Kpay/Wave ·Äñ·ÄØ·Äî·Ä∫·Ä∏: <b>09786284670</b> (DHMK)</p>
            <input type="number" id="deposit-amount" placeholder="·ÄÑ·ÄΩ·Ä±·Äï·Äô·Ä¨·Äè (MMK)" min="100" step="100">
            <input type="text" id="transaction-id" placeholder="·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏ 6 ·Äú·ÄØ·Ä∂·Ä∏ (Transaction ID)">
            <button onclick="submitDeposit()">·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÜ·Ä≠·ÄØ·Äô·Ää·Ä∫</button>
            <button onclick="closeModal('depositModal')">‚ùå ·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫</button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h2>üè¶ Withdraw</h2>
            <select id="withdraw-method">
                <option value="Kpay">Kpay</option>
                <option value="Wave">Wave</option>
            </select>
            <input type="text" id="withdraw-phone" placeholder="Kpay/Wave ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Äê·Ä∫">
            <input type="number" id="withdraw-amount" placeholder="·ÄÑ·ÄΩ·Ä±·Äï·Äô·Ä¨·Äè (MMK)" min="100" step="100">
            <button onclick="submitWithdraw()">·Äê·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÜ·Ä≠·ÄØ·Äô·Ää·Ä∫</button>
            <button onclick="closeModal('withdrawModal')">‚ùå ·Äï·Ä≠·Äê·Ä∫·Äô·Ää·Ä∫</button>
        </div>
    </div>

    <script>
        const userId = localStorage.getItem('userId') || `user_${Math.random().toString(36).substr(2, 9)}`;
        localStorage.setItem('userId', userId);

        let balance = parseInt(localStorage.getItem(`${userId}_balance`) || '0');
        let totalBet = 0;
        let currentChip = null;
        let bets = {};
        let timeLeft = 30;
        let gameState = 'betting';
        let usedTransactionIds = JSON.parse(localStorage.getItem('usedTransactionIds') || '[]');
        let onlinePlayers = 0;

        const spinBtn = document.getElementById('spinBtn');
        const balanceValue = document.getElementById('balance-value');
        const totalBetValue = document.getElementById('total-bet-value');
        const betTable = document.getElementById('betTable');
        const roulette = document.getElementById('roulette');
        const betChips = document.getElementById('betChips');
        const timer = document.getElementById('timer');
        const result = document.getElementById('result');

        // GitHub API Config
        const GITHUB_TOKEN = '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';
        const GITHUB_REPO = 'Opper125/casino-roulette';
        const GITHUB_API = `https://api.github.com/repos/${GITHUB_REPO}/contents`;

        async function fetchGitHubData(file) {
            const response = await fetch(`${GITHUB_API}/${file}`, {
                headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
            });
            if (response.ok) {
                const data = await response.json();
                return JSON.parse(atob(data.content));
            }
            return null;
        }

        async function updateGitHubData(file, data) {
            const existing = await fetchGitHubData(file);
            const content = btoa(JSON.stringify(data, null, 2));
            const response = await fetch(`${GITHUB_API}/${file}`, {
                method: existing ? 'PUT' : 'POST',
                headers: { 'Authorization': `token ${GITHUB_TOKEN}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: `Update ${file}`,
                    content,
                    sha: existing ? existing.sha : undefined
                })
            });
            return response.ok;
        }

        // Load initial data from GitHub
        async function loadInitialData() {
            const userData = await fetchGitHubData('users.json');
            if (userData && userData[userId]) {
                balance = userData[userId].balance;
            }
            updateBalance();
            const gameData = await fetchGitHubData('game.json');
            if (gameData) {
                onlinePlayers = Object.keys(gameData.onlinePlayers || {}).length;
                document.getElementById('online-players').innerHTML = `Online Players: ${onlinePlayers}`;
                bets = gameData.bets || {};
                updateBetCounts(bets);
            }
            // Register user as online
            await updateGitHubData('game.json', { ...gameData, onlinePlayers: { ...gameData?.onlinePlayers, [userId]: true } });
        }

        // Sync with Serverless Game State
        async function syncGameState() {
            const response = await fetch('/.netlify/functions/game-loop');
            const data = await response.json();
            gameState = data.state;
            timeLeft = data.timeLeft;
            timer.innerHTML = `Time Left: ${timeLeft}s`;
            if (gameState === 'spinning') spinWheel(data.finalAngle);
            else if (gameState === 'result') showResult(data.result);
            else if (gameState === 'betting' && timeLeft > 5) {
                betTable.style.display = 'grid';
                betChips.style.display = 'flex';
                result.innerHTML = "üé≤ Chip ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏ Bet ·Äê·ÄÑ·Ä∫·Äï·Ä´!";
            } else if (gameState === 'betting' && timeLeft <= 5) {
                betTable.style.display = 'none';
                betChips.style.display = 'none';
                result.innerHTML = "‚è≥ Betting ·Äï·Ä≠·Äê·Ä∫·Äê·Ä±·Ä¨·Ä∑·Äô·Ää·Ä∫!";
            }
            const gameData = await fetchGitHubData('game.json');
            bets = gameData?.bets || {};
            updateBetCounts(bets);
        }

        setInterval(syncGameState, 1000);

        function setupRoulette() {
            const numbers = Array.from({ length: 36 }, (_, i) => i + 1);
            numbers.forEach((num, i) => {
                const slot = document.createElement('div');
                slot.className = 'number-slot';
                slot.textContent = num;
                slot.style.transform = `rotate(${i * 10}deg) translateY(-135px)`;
                slot.style.background = i % 2 === 0 ? '#000' : '#f44336';
                roulette.appendChild(slot);
            });
            const pointer = document.createElement('div');
            pointer.id = 'pointer';
            pointer.className = 'pointer';
            roulette.appendChild(pointer);
        }

        function updateBalance(amount = 0) {
            if (amount !== 0) {
                balance += amount;
                localStorage.setItem(`${userId}_balance`, balance);
                updateGitHubData('users.json', { [userId]: { balance } });
            }
            balanceValue.innerHTML = balance;
            document.getElementById('balance').innerHTML = `Balance: <span id="balance-value">${balance}</span> MMK`;
        }

        function updateTotalBet() {
            totalBet = Object.values(bets).reduce((sum, value) => sum + value, 0);
            totalBetValue.innerHTML = totalBet;
        }

        function showDepositModal() { document.getElementById('depositModal').style.display = 'flex'; }
        function showWithdrawModal() { document.getElementById('withdrawModal').style.display = 'flex'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }

        async function submitDeposit() {
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const transactionId = document.getElementById('transaction-id').value;
            if (amount < 100 || transactionId.length !== 6 || usedTransactionIds.includes(transactionId)) {
                result.innerHTML = "‚ùå ·ÄÑ·ÄΩ·Ä±·Äï·Äô·Ä¨·Äè ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ Transaction ID ·Äô·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·Äï·Ä´!";
                return;
            }
            usedTransactionIds.push(transactionId);
            localStorage.setItem('usedTransactionIds', JSON.stringify(usedTransactionIds));
            const response = await fetch('/.netlify/functions/deposit', {
                method: 'POST',
                body: JSON.stringify({ userId, amount, transactionId })
            });
            const data = await response.json();
            if (data.status === 'approved') {
                updateBalance(amount);
                result.innerHTML = "‚úÖ Deposit ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ!";
            } else {
                result.innerHTML = "‚ùå Deposit ·Äï·Äö·Ä∫·ÄÅ·Äª·ÄÅ·Ä∂·Äõ·Äï·Ä´·Äê·Äö·Ä∫!";
            }
            closeModal('depositModal');
        }

        async function submitWithdraw() {
            const method = document.getElementById('withdraw-method').value;
            const phone = document.getElementById('withdraw-phone').value;
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            if (amount < 100 || amount > balance || !phone) {
                result.innerHTML = "‚ùå ·ÄÑ·ÄΩ·Ä±·Äï·Äô·Ä¨·Äè ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Äê·Ä∫ ·Äô·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·Äï·Ä´!";
                return;
            }
            updateBalance(-amount);
            const response = await fetch('/.netlify/functions/withdraw', {
                method: 'POST',
                body: JSON.stringify({ userId, amount, method, phone })
            });
            const data = await response.json();
            if (data.status === 'rejected') {
                updateBalance(amount);
                result.innerHTML = "‚ùå Withdraw ·Äï·Äö·Ä∫·ÄÅ·Äª·ÄÅ·Ä∂·Äõ·Äï·Ä´·Äê·Äö·Ä∫!";
            } else {
                result.innerHTML = "‚úÖ Withdraw ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ!";
            }
            closeModal('withdrawModal');
        }

        function setupBetTable() {
            const table = [
                ...Array.from({ length: 36 }, (_, i) => ({
                    id: `${i + 1}`,
                    text: `${i + 1}`,
                    class: i % 2 === 0 ? 'black' : 'red',
                    colSpan: 1
                })),
                { id: '1-18', text: '1-18', class: '', colSpan: 2 },
                { id: '19-36', text: '19-36', class: '', colSpan: 2 },
                { id: 'odd', text: 'Odd', class: '', colSpan: 2 },
                { id: 'even', text: 'Even', class: '', colSpan: 2 },
                { id: 'black', text: 'Black', class: 'black', colSpan: 2 },
                { id: 'red', text: 'Red', class: 'red', colSpan: 2 },
                { id: '1st12', text: '1-12', class: '', colSpan: 2 },
                { id: '2nd12', text: '13-24', class: '', colSpan: 2 },
                { id: '3rd12', text: '25-36', class: '', colSpan: 2 },
                { id: 'col1', text: '1st', class: '', colSpan: 2 },
                { id: 'col2', text: '2nd', class: '', colSpan: 2 },
                { id: 'col3', text: '3rd', class: '', colSpan: 2 }
            ];
            table.forEach(area => {
                const div = document.createElement('div');
                div.className = `bet-area ${area.class}`;
                div.id = `bet-${area.id}`;
                div.innerHTML = `${area.text}<span class="player-count" id="count-${area.id}">0</span>`;
                div.style.gridColumn = area.colSpan > 1 ? `span ${area.colSpan}` : 'auto';
                div.onclick = () => placeBet(area.id);
                betTable.appendChild(div);
            });
        }

        async function placeBet(areaId) {
            if (gameState !== 'betting' || timeLeft <= 5 || !currentChip || balance < currentChip) return;
            balance -= currentChip;
            updateBalance();
            bets[areaId] = (bets[areaId] || 0) + currentChip;
            updateTotalBet();
            const response = await fetch('/.netlify/functions/place-bet', {
                method: 'POST',
                body: JSON.stringify({ userId, areaId, amount: currentChip })
            });
            const betData = await response.json();
            updateBetCounts(betData);
            const chipElement = document.createElement('div');
            chipElement.className = 'chip-animation';
            chipElement.textContent = currentChip >= 1000 ? `${currentChip/1000}K` : currentChip;
            const balancePos = balanceValue.getBoundingClientRect();
            const targetPos = document.getElementById(`bet-${areaId}`).getBoundingClientRect();
            chipElement.style.left = `${balancePos.left + balancePos.width / 2 - 15}px`;
            chipElement.style.top = `${balancePos.top + balancePos.height / 2 - 15}px`;
            chipElement.style.setProperty('--target-x', `${targetPos.left - balancePos.left}px`);
            chipElement.style.setProperty('--target-y', `${targetPos.top - balancePos.top}px`);
            document.body.appendChild(chipElement);
            setTimeout(() => {
                chipElement.remove();
                const existingChip = document.getElementById(`bet-${areaId}`).querySelector('.bet-chip');
                if (existingChip) {
                    existingChip.textContent = bets[areaId] >= 1000 ? `${bets[areaId]/1000}K` : bets[areaId];
                } else {
                    const betChip = document.createElement('div');
                    betChip.className = 'bet-chip';
                    betChip.textContent = bets[areaId] >= 1000 ? `${bets[areaId]/1000}K` : bets[areaId];
                    document.getElementById(`bet-${areaId}`).appendChild(betChip);
                }
            }, 1000);
        }

        function updateBetCounts(betData) {
            Object.keys(betData).forEach(areaId => {
                const countEl = document.getElementById(`count-${areaId}`);
                if (countEl) countEl.innerHTML = betData[areaId].players || 0;
            });
        }

        function spinWheel(finalAngle) {
            const pointer = document.getElementById('pointer');
            roulette.style.display = 'block';
            betTable.style.display = 'none';
            betChips.style.display = 'none';
            document.getElementById('total-bet').style.display = 'none';
            result.innerHTML = "·Äò·Ä±·Ä¨·Äú·ÄØ·Ä∂·Ä∏·Äú·Äæ·Ää·Ä∑·Ä∫·Äî·Ä±·Äï·Ä´·Äê·Äö·Ä∫... ‚è≥";
            pointer.style.setProperty('--final-angle', `${finalAngle}deg`);
            pointer.classList.add('spinning');
            setTimeout(() => pointer.classList.remove('spinning'), 8000);
        }

        function showResult(resultData) {
            const number = resultData.number;
            let winnings = 0;
            let message = `üé≤ ·Äò·Ä±·Ä¨·Äú·ÄØ·Ä∂·Ä∏·Äõ·Äï·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äê·Ä≤·Ä∑ ·ÄÇ·Äè·Äî·Ä∫·Ä∏: ${number}<br>`;
            for (let area in bets) {
                let multiplier = 0;
                if (area === `${number}`) multiplier = 36 + (resultData.bonuses[number] || 0);
                else if (area === 'red' && resultData.isRed) multiplier = 2;
                else if (area === 'black' && resultData.isBlack) multiplier = 2;
                else if (area === 'odd' && resultData.isOdd) multiplier = 2;
                else if (area === 'even' && resultData.isEven) multiplier = 2;
                else if (area === '1-18' && resultData.isLow) multiplier = 2;
                else if (area === '19-36' && resultData.isHigh) multiplier = 2;
                else if (area === resultData.dozen) multiplier = 3;
                else if (area === resultData.column) multiplier = 3;
                if (multiplier > 0) winnings += bets[area] * multiplier;
            }
            if (winnings > 0) {
                message += `üéâ ·Ä°·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·Äõ·Äæ·Ä≠·Äï·Ä´·Äê·Äö·Ä∫! ${winnings} MMK`;
                updateBalance(winnings);
            } else {
                message += "üò¢ ·Ä°·Äõ·Äæ·ÄØ·Ä∂·Ä∏·Äï·Ä´·Åã ·Äë·Äï·Ä∫·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·Äï·Ä´!";
            }
            result.innerHTML = message;
            setTimeout(() => {
                roulette.style.display = 'none';
                betTable.style.display = 'grid';
                betChips.style.display = 'flex';
                document.getElementById('total-bet').style.display = 'block';
                bets = {};
                totalBet = 0;
                updateTotalBet();
            }, 2000);
        }

        document.querySelectorAll('.chip').forEach(chip => {
            chip.onclick = () => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                currentChip = parseInt(chip.dataset.value);
            };
        });

        function toggleGuide() {
            document.getElementById('guide').classList.toggle('active');
        }

        // Initialize
        setupRoulette();
        setupBetTable();
        loadInitialData();

        // Netlify Functions Logic (Embedded)
        const gameLoop = async () => {
            let gameData = await fetchGitHubData('game.json') || { onlinePlayers: {}, bets: {}, state: 'betting', timeLeft: 30 };
            if (timeLeft > 0) {
                timeLeft--;
            } else {
                if (gameState === 'betting') {
                    gameState = 'spinning';
                    const finalAngle = Math.floor(Math.random() * 360);
                    timeLeft = 8;
                    await updateGitHubData('game.json', { ...gameData, state: gameState, timeLeft, finalAngle });
                    setTimeout(async () => {
                        const result = checkBallPosition(finalAngle);
                        gameState = 'result';
                        timeLeft = 2;
                        await updateGitHubData('game.json', { ...gameData, state: gameState, timeLeft, result, bets: {} });
                        setTimeout(async () => {
                            gameState = 'betting';
                            timeLeft = 30;
                            await updateGitHubData('game.json', { ...gameData, state: gameState, timeLeft });
                        }, 2000);
                    }, 8000);
                }
            }
            await updateGitHubData('game.json', { ...gameData, state: gameState, timeLeft, bets });
        };

        function checkBallPosition(finalAngle) {
            const anglePerNumber = 360 / 36;
            const index = Math.floor(finalAngle / anglePerNumber);
            const number = (index % 36) + 1;
            const bonuses = generateBonuses();
            return {
                number,
                isRed: index % 2 === 1,
                isBlack: index % 2 === 0,
                isOdd: number % 2 === 1,
                isEven: number % 2 === 0,
                isLow: number <= 18,
                isHigh: number > 18,
                dozen: number <= 12 ? '1st12' : number <= 24 ? '2nd12' : '3rd12',
                column: index % 3 === 0 ? 'col1' : index % 3 === 1 ? 'col2' : 'col3',
                bonuses
            };
        }

        function generateBonuses() {
            const bonusCount = Math.floor(Math.random() * 3) + 1;
            const bonusNumbers = new Set();
            while (bonusNumbers.size < bonusCount) {
                bonusNumbers.add(Math.floor(Math.random() * 36) + 1);
            }
            const bonuses = {};
            bonusNumbers.forEach(num => {
                bonuses[num] = Math.floor(Math.random() * 451) + 50;
            });
            return bonuses;
        }

        // Start game loop simulation
        setInterval(gameLoop, 1000);
    </script>
</body>
                                                                                                                    </html>
