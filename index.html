<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Roulette - Powered by Netlify</title>
    <style>
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #1a1a1a, #2c003e); color: #ffd700; margin: 0; padding: 10px; }
        .game-container { max-width: 600px; margin: auto; background: rgba(30, 30, 30, 0.9); padding: 20px; border-radius: 15px; box-shadow: 0 0 30px rgba(255, 215, 0, 0.7); text-align: center; }
        h1 { font-size: 2em; text-shadow: 0 0 15px #ffd700; }
        .roulette-wheel { margin: 20px auto; position: relative; }
        canvas { display: block; margin: 0 auto; }
        .bet-table { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin: 15px 0; }
        .bet-area { padding: 10px; background: #444; border: 2px solid #ffd700; cursor: pointer; border-radius: 8px; transition: background 0.3s; }
        .bet-area:hover { background: #666; }
        .chip { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(45deg, #ffd700, #b8860b); display: inline-flex; align-items: center; justify-content: center; cursor: pointer; margin: 5px; box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .chip.active { border: 3px solid #fff; }
        button { padding: 10px 20px; background: linear-gradient(45deg, #ffd700, #b8860b); color: #000; border: none; border-radius: 8px; cursor: pointer; margin: 5px; font-weight: bold; transition: transform 0.2s; }
        button:hover { transform: scale(1.05); }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; justify-content: center; align-items: center; }
        .modal-content { background: #1e1e1e; padding: 25px; border-radius: 15px; color: #ffd700; width: 90%; max-width: 400px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .support-section { margin-top: 20px; background: #333; padding: 15px; border-radius: 10px; }
        textarea { width: 100%; padding: 10px; border-radius: 5px; background: #222; color: #ffd700; border: 1px solid #ffd700; }
        input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; background: #222; color: #ffd700; border: 1px solid #ffd700; }
        #countdown { font-size: 2em; color: #ff4500; text-shadow: 0 0 10px #ff4500; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ° Casino Roulette ğŸ°</h1>
        <div id="online-players">Online Players: 0</div>
        <div id="balance">Balance: <span id="balance-value">0</span> MMK</div>
        <div class="money-controls">
            <button onclick="showDepositModal()">ğŸ’¸ Deposit</button>
            <button onclick="showWithdrawModal()">ğŸ¦ Withdraw</button>
        </div>
        <div class="roulette-wheel">
            <canvas id="wheel" width="300" height="300"></canvas>
            <div id="countdown"></div>
        </div>
        <div class="timer" id="timer">Time Left: 30s</div>
        <div class="bet-table" id="betTable"></div>
        <div class="bet-chips">
            <div class="chip" data-value="1000">1K</div>
            <div class="chip" data-value="10000">10K</div>
            <div class="chip" data-value="100000">100K</div>
        </div>
        <div id="result">á€€á€…á€¬á€¸á€›á€”á€º á€¡á€€á€±á€¬á€„á€·á€ºá€á€„á€ºá€•á€«!</div>
        <div class="support-section">
            <h3>ğŸ“ Customer Support</h3>
            <textarea id="support-message" placeholder="á€á€„á€·á€ºá€™á€±á€¸á€á€½á€”á€ºá€¸á€€á€­á€¯ á€›á€±á€¸á€•á€«..."></textarea>
            <button onclick="sendSupportMessage()">ğŸ“© á€•á€­á€¯á€·á€™á€Šá€º</button>
        </div>
    </div>

    <div class="modal" id="loginModal" style="display: flex;">
        <div class="modal-content">
            <h2>ğŸ® á€¡á€€á€±á€¬á€„á€·á€ºá€á€„á€ºá€›á€”á€º</h2>
            <input type="text" id="phone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€º (09xxxxxxxxx)">
            <input type="password" id="pin" placeholder="PIN (6 á€œá€¯á€¶á€¸)">
            <button onclick="login()">á€á€„á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <div class="modal" id="depositModal">
        <div class="modal-content">
            <h2>ğŸ’¸ Deposit</h2>
            <p>Kpay/Wave: <b>09786284670</b> (DHMK)</p>
            <input type="number" id="deposit-amount" placeholder="á€„á€½á€±á€•á€™á€¬á€ (MMK)">
            <input type="text" id="transaction-id" placeholder="Transaction ID (6 á€œá€¯á€¶á€¸)">
            <button onclick="submitDeposit()">á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€™á€Šá€º</button>
            <button onclick="closeModal('depositModal')">âŒ á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <h2>ğŸ¦ Withdraw</h2>
            <input type="text" id="withdraw-phone" placeholder="Kpay/Wave á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€á€º">
            <input type="number" id="withdraw-amount" placeholder="á€„á€½á€±á€•á€™á€¬á€ (MMK)">
            <button onclick="submitWithdraw()">á€á€±á€¬á€„á€ºá€¸á€†á€­á€¯á€™á€Šá€º</button>
            <button onclick="closeModal('withdrawModal')">âŒ á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <script>
        const REPO = 'casino-roulette';
        const OWNER = 'Opper125';
        const FILE_PATH = 'data.json';
        const BASE_URL = 'https://casino-opper.netlify.app';

        let userId, phone, balance = 0, bets = {}, timeLeft = 30, gameState = 'betting', wheelAngle = 0;

        async function syncData(action, updates = {}) {
            try {
                const response = await fetch(`${BASE_URL}/.netlify/functions/sync`, {
                    method: 'POST',
                    body: JSON.stringify({ action, updates, repo: REPO, owner: OWNER, path: FILE_PATH })
                });
                if (!response.ok) throw new Error('Sync failed');
                return await response.json();
            } catch (error) {
                console.error('Sync Error:', error);
                return { users: {}, requests: {}, messages: [], game: { state: 'betting', timeLeft: 30, onlinePlayers: 0, result: null } };
            }
        }

        async function login() {
            phone = document.getElementById('phone').value;
            const pin = document.getElementById('pin').value;
            if (!phone.match(/^09\d{8,9}$/) || pin.length !== 6) {
                document.getElementById('result').innerHTML = "âŒ á€–á€¯á€”á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º PIN á€™á€™á€¾á€”á€ºá€•á€«!";
                return;
            }
            userId = btoa(phone + pin);
            const data = await syncData('get');
            const users = data.users || {};
            let userData = users[userId] || { balance: 10000, bets: {}, phone, lastActive: Date.now(), warnings: 0, banUntil: 0 };
            balance = userData.balance;
            bets = userData.bets || {};
            users[userId] = userData;
            data.game.onlinePlayers = (data.game.onlinePlayers || 0) + 1;
            await syncData('set', { users, game: data.game });
            updateUI();
            document.getElementById('loginModal').style.display = 'none';
            syncGameState();
            drawWheel();
        }

        async function updateUI() {
            document.getElementById('balance-value').innerHTML = balance;
            document.getElementById('timer').innerHTML = `Time Left: ${timeLeft}s`;
            const data = await syncData('get');
            document.getElementById('online-players').innerHTML = `Online Players: ${data.game.onlinePlayers || 0}`;
            if (gameState === 'betting') {
                document.getElementById('result').innerHTML = timeLeft <= 5 ? "â° Betting Closed!" : "ğŸ² Bet á€á€„á€ºá€•á€«!";
                if (timeLeft <= 5) document.getElementById('countdown').innerHTML = timeLeft;
                else document.getElementById('countdown').innerHTML = '';
            } else if (gameState === 'spinning') {
                document.getElementById('result').innerHTML = "â³ á€œá€¾á€Šá€·á€ºá€”á€±á€•á€«á€á€šá€º...";
                spinWheel();
            } else if (gameState === 'result') {
                await showResult(data);
            }
        }

        function syncGameState() {
            setInterval(async () => {
                const data = await syncData('get');
                let game = data.game || { state: 'betting', timeLeft: 30, onlinePlayers: 0, result: null };
                gameState = game.state;
                timeLeft = game.timeLeft > 0 ? game.timeLeft - 1 : 0;
                if (timeLeft === 0) {
                    if (gameState === 'betting') {
                        gameState = 'spinning';
                        timeLeft = 8;
                    } else if (gameState === 'spinning') {
                        gameState = 'result';
                        timeLeft = 2;
                        game.result = Math.floor(Math.random() * 36) + 1;
                    } else {
                        gameState = 'betting';
                        timeLeft = 30;
                        game.result = null;
                    }
                }
                game = { state: gameState, timeLeft, onlinePlayers: game.onlinePlayers, result: game.result, lastUpdate: Date.now() };
                await syncData('set', { game });
                await updateUI();
            }, 1000);
        }

        function setupBetTable() {
            const table = ['1', '2', '3', '4', '5', '6', 'red', 'black', 'odd', 'even', '1-18', '19-36'];
            table.forEach(id => {
                const div = document.createElement('div');
                div.className = 'bet-area';
                div.id = `bet-${id}`;
                div.innerHTML = id;
                div.onclick = () => placeBet(id);
                document.getElementById('betTable').appendChild(div);
            });
        }

        async function placeBet(areaId) {
            if (gameState !== 'betting' || timeLeft <= 5) return;
            const chip = parseInt(document.querySelector('.chip.active')?.dataset.value);
            if (!chip || balance < chip) return;
            balance -= chip;
            bets[areaId] = (bets[areaId] || 0) + chip;
            const data = await syncData('get');
            data.users[userId] = { balance, bets, phone, lastActive: Date.now(), warnings: data.users[userId].warnings, banUntil: data.users[userId].banUntil };
            await syncData('set', data);
            updateUI();
        }

        document.querySelectorAll('.chip').forEach(chip => {
            chip.onclick = () => {
                if (gameState === 'betting' && timeLeft > 5) {
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                }
            };
        });

        async function showResult(data) {
            const result = data.game.result;
            let winnings = bets[result] ? bets[result] * 36 : 0;
            balance += winnings;
            bets = {};
            data.users[userId] = { balance, bets, phone, lastActive: Date.now(), warnings: data.users[userId].warnings, banUntil: data.users[userId].banUntil };
            await syncData('set', data);
            document.getElementById('result').innerHTML = winnings ? `ğŸ‰ á€¡á€”á€­á€¯á€„á€ºá€›: ${winnings} MMK (Result: ${result})` : `ğŸ˜¢ á€¡á€›á€¾á€¯á€¶á€¸á€•á€« (Result: ${result})`;
        }

        function drawWheel() {
            const canvas = document.getElementById('wheel');
            const ctx = canvas.getContext('2d');
            const radius = canvas.width / 2;
            const numbers = Array.from({ length: 37 }, (_, i) => i);
            const colors = ['#ff0000', '#000000'];

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(radius, radius);
            ctx.rotate(wheelAngle * Math.PI / 180);

            numbers.forEach((num, i) => {
                const angle = (i * 360 / 37) * Math.PI / 180;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, angle, angle + (360 / 37) * Math.PI / 180);
                ctx.fillStyle = colors[i % 2];
                ctx.fill();
                ctx.strokeStyle = '#ffd700';
                ctx.stroke();

                ctx.save();
                ctx.rotate(angle + (360 / 37 / 2) * Math.PI / 180);
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.fillText(num, radius - 20, 5);
                ctx.restore();
            });

            ctx.restore();
        }

        function spinWheel() {
            wheelAngle += 20; // Spin speed
            drawWheel();
            if (gameState === 'spinning') requestAnimationFrame(spinWheel);
        }

        function showDepositModal() { 
            const data = syncData('get').then(d => {
                if (d.users[userId]?.banUntil > Date.now()) return;
                document.getElementById('depositModal').style.display = 'flex';
            });
        }
        function showWithdrawModal() { 
            const data = syncData('get').then(d => {
                if (d.users[userId]?.banUntil > Date.now()) return;
                document.getElementById('withdrawModal').style.display = 'flex';
            });
        }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        async function submitDeposit() {
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const transactionId = document.getElementById('transaction-id').value;
            if (amount < 100 || transactionId.length !== 6) return;
            const data = await syncData('get');
            if (Object.values(data.requests).some(req => req.transactionId === transactionId)) {
                data.users[userId].warnings = (data.users[userId].warnings || 0) + 1;
                if (data.users[userId].warnings >= 3) data.users[userId].banUntil = Date.now() + 30 * 60 * 1000; // 30 minutes ban
                await syncData('set', data);
                alert('Transaction ID á€‘á€•á€ºá€á€¯á€¶á€¸á€™á€¾á€¯ á€á€½á€±á€·á€›á€¾á€­á€•á€«á€á€Šá€ºá‹ Warning á€•á€±á€¸á€‘á€¬á€¸á€•á€«á€á€Šá€ºá‹');
                return;
            }
            const requestId = `${userId}_${Date.now()}`;
            data.requests[requestId] = { userId, phone, amount, transactionId, type: 'deposit', status: 'pending', timestamp: Date.now() };
            await syncData('set', data);
            closeModal('depositModal');
        }

        async function submitWithdraw() {
            const amount = parseInt(document.getElementById('withdraw-amount').value);
            const withdrawPhone = document.getElementById('withdraw-phone').value;
            if (amount < 100 || amount > balance || !withdrawPhone) return;
            balance -= amount;
            const data = await syncData('get');
            data.users[userId].balance = balance;
            const requestId = `${userId}_${Date.now()}`;
            data.requests[requestId] = { userId, phone, amount, withdrawPhone, type: 'withdraw', status: 'pending', timestamp: Date.now() };
            await syncData('set', data);
            closeModal('withdrawModal');
            updateUI();
        }

        async function sendSupportMessage() {
            const message = document.getElementById('support-message').value;
            if (!message || !userId) return;
            const data = await syncData('get');
            data.messages.push({ userId, phone, message, timestamp: Date.now() });
            await syncData('set', data);
            document.getElementById('support-message').value = '';
            alert('á€™á€€á€ºá€†á€±á€·á€á€»á€º á€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!');
        }

        setupBetTable();
    </script>
</body>
</html>
